{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClient | undefined\n}\n\nexport const prisma: PrismaClient = globalThis.prisma ?? new PrismaClient({ log: ['error'] })\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma\n\nexport default prisma\n"],"names":[],"mappings":";;;;;;AAAA;;AAOO,MAAM,SAAuB,WAAW,MAAM,IAAI,IAAI,6IAAY,CAAC;IAAE,KAAK;QAAC;KAAQ;AAAC;AAE3F,wCAA2C,WAAW,MAAM,GAAG;uCAEhD","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/src/lib/requireRole.ts"],"sourcesContent":["import type { NextAuthOptions } from 'next-auth'\nimport { getServerSession } from 'next-auth'\nimport { NextResponse } from 'next/server'\n\nexport type Role = 'USER' | 'ADMIN'\n\nexport async function requireRole(\n  required: Role,\n  authOptions?: NextAuthOptions\n): Promise<{ user: any | null; error: 'unauthenticated' | 'forbidden' | null }> {\n  const session = authOptions ? await getServerSession(authOptions) : await (getServerSession as any)()\n  const user = session?.user as any\n  if (!user) return { user: null, error: 'unauthenticated' }\n  const role: Role = (user.role ?? 'USER')\n  if (required === 'ADMIN' && role !== 'ADMIN') return { user: null, error: 'forbidden' }\n  return { user, error: null }\n}\n\nexport async function requireRoleOrResponse(\n  required: Role,\n  authOptions?: NextAuthOptions\n): Promise<{ user: any } | NextResponse> {\n  const session = authOptions ? await getServerSession(authOptions) : await (getServerSession as any)()\n  const user = session?.user as any\n  if (!user) return NextResponse.json({ error: 'unauthenticated' }, { status: 401 })\n  const role: Role = (user.role ?? 'USER')\n  if (required === 'ADMIN' && role !== 'ADMIN') return NextResponse.json({ error: 'forbidden' }, { status: 403 })\n  return { user }\n}\n"],"names":[],"mappings":";;;;;;AACA;AACA;;;AAIO,eAAe,YACpB,QAAc,EACd,WAA6B;IAE7B,MAAM,UAAU,cAAc,MAAM,IAAA,2JAAgB,EAAC,eAAe,MAAM,AAAC,2JAAgB;IAC3F,MAAM,OAAO,SAAS;IACtB,IAAI,CAAC,MAAM,OAAO;QAAE,MAAM;QAAM,OAAO;IAAkB;IACzD,MAAM,OAAc,KAAK,IAAI,IAAI;IACjC,IAAI,aAAa,WAAW,SAAS,SAAS,OAAO;QAAE,MAAM;QAAM,OAAO;IAAY;IACtF,OAAO;QAAE;QAAM,OAAO;IAAK;AAC7B;AAEO,eAAe,sBACpB,QAAc,EACd,WAA6B;IAE7B,MAAM,UAAU,cAAc,MAAM,IAAA,2JAAgB,EAAC,eAAe,MAAM,AAAC,2JAAgB;IAC3F,MAAM,OAAO,SAAS;IACtB,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAkB,GAAG;QAAE,QAAQ;IAAI;IAChF,MAAM,OAAc,KAAK,IAAI,IAAI;IACjC,IAAI,aAAa,WAAW,SAAS,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;IAC7G,OAAO;QAAE;IAAK;AAChB","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nconst url = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || ''\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ''\n\nexport const supabaseServiceReady = Boolean(url && serviceKey)\n\nfunction createDisabledClient(): any {\n  const err = async () => { throw new Error('supabase_service_not_configured') }\n  const from = () => ({\n    select: err,\n    insert: err,\n    update: err,\n    delete: err,\n    eq: () => ({ select: err, insert: err, update: err, delete: err }),\n    order: () => ({ select: err }),\n    range: () => ({ select: err }),\n    maybeSingle: err,\n  })\n  return { auth: { getUser: err }, from }\n}\n\nexport const supabaseServer = supabaseServiceReady ? createClient(url, serviceKey) : createDisabledClient()\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,oFAA4C;AAChF,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,IAAI;AAErD,MAAM,uBAAuB,QAAQ,OAAO;AAEnD,SAAS;IACP,MAAM,MAAM;QAAc,MAAM,IAAI,MAAM;IAAmC;IAC7E,MAAM,OAAO,IAAM,CAAC;YAClB,QAAQ;YACR,QAAQ;YACR,QAAQ;YACR,QAAQ;YACR,IAAI,IAAM,CAAC;oBAAE,QAAQ;oBAAK,QAAQ;oBAAK,QAAQ;oBAAK,QAAQ;gBAAI,CAAC;YACjE,OAAO,IAAM,CAAC;oBAAE,QAAQ;gBAAI,CAAC;YAC7B,OAAO,IAAM,CAAC;oBAAE,QAAQ;gBAAI,CAAC;YAC7B,aAAa;QACf,CAAC;IACD,OAAO;QAAE,MAAM;YAAE,SAAS;QAAI;QAAG;IAAK;AACxC;AAEO,MAAM,iBAAiB,uBAAuB,IAAA,yMAAY,EAAC,KAAK,cAAc","debugId":null}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/src/lib/supabaseServer.ts"],"sourcesContent":["export { supabaseServer, supabaseServiceReady } from '../../lib/supabaseServer'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/app/api/user/notifications/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\nimport prisma from '@lib/prisma'\nimport { requireRole } from '@lib/requireRole'\nimport { supabaseServer } from '@lib/supabaseServer'\n\nexport async function GET(req: NextRequest) {\n  const url = new URL(req.url)\n  let userId = ''\n  const token = url.searchParams.get('token') || req.headers.get('authorization')?.replace(/^Bearer\\s+/i, '') || ''\n  if (token) {\n    const { data, error } = await supabaseServer.auth.getUser(token)\n    if (!error && data?.user?.id) userId = String(data.user.id)\n  }\n  if (!userId) {\n    const { user, error } = await requireRole('USER')\n    if (error) return new Response(JSON.stringify({ error }), { status: error === 'unauthenticated' ? 401 : 403 })\n    userId = String(user.id)\n  }\n  const limit = Number(url.searchParams.get('limit') ?? '20')\n  const sinceParam = url.searchParams.get('since')\n  const unreadOnly = url.searchParams.get('unreadOnly') === 'true'\n  const type = url.searchParams.get('type')\n  const where: any = { userId }\n  if (unreadOnly) where.read = false\n  if (type) where.type = type\n  if (sinceParam) {\n    const since = new Date(sinceParam)\n    if (!isNaN(since.getTime())) where.createdAt = { gt: since }\n  }\n  const items = await prisma.notification.findMany({\n    where,\n    orderBy: { createdAt: 'desc' },\n    take: Math.max(1, Math.min(100, limit)),\n  })\n  return new Response(JSON.stringify({ items }), { status: 200 })\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AAAA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;IAC3B,IAAI,SAAS;IACb,MAAM,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC,kBAAkB,QAAQ,eAAe,OAAO;IAC/G,IAAI,OAAO;QACT,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAc,CAAC,IAAI,CAAC,OAAO,CAAC;QAC1D,IAAI,CAAC,SAAS,MAAM,MAAM,IAAI,SAAS,OAAO,KAAK,IAAI,CAAC,EAAE;IAC5D;IACA,IAAI,CAAC,QAAQ;QACX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,0IAAW,EAAC;QAC1C,IAAI,OAAO,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE;QAAM,IAAI;YAAE,QAAQ,UAAU,oBAAoB,MAAM;QAAI;QAC5G,SAAS,OAAO,KAAK,EAAE;IACzB;IACA,MAAM,QAAQ,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;IACtD,MAAM,aAAa,IAAI,YAAY,CAAC,GAAG,CAAC;IACxC,MAAM,aAAa,IAAI,YAAY,CAAC,GAAG,CAAC,kBAAkB;IAC1D,MAAM,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC;IAClC,MAAM,QAAa;QAAE;IAAO;IAC5B,IAAI,YAAY,MAAM,IAAI,GAAG;IAC7B,IAAI,MAAM,MAAM,IAAI,GAAG;IACvB,IAAI,YAAY;QACd,MAAM,QAAQ,IAAI,KAAK;QACvB,IAAI,CAAC,MAAM,MAAM,OAAO,KAAK,MAAM,SAAS,GAAG;YAAE,IAAI;QAAM;IAC7D;IACA,MAAM,QAAQ,MAAM,iIAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;QAC/C;QACA,SAAS;YAAE,WAAW;QAAO;QAC7B,MAAM,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK;IAClC;IACA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;QAAE;IAAM,IAAI;QAAE,QAAQ;IAAI;AAC/D","debugId":null}}]
}