{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nconst url = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || ''\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ''\n\nexport const supabaseServiceReady = Boolean(url && serviceKey)\n\nfunction createDisabledClient(): any {\n  const err = async () => { throw new Error('supabase_service_not_configured') }\n  const from = () => ({\n    select: err,\n    insert: err,\n    update: err,\n    delete: err,\n    eq: () => ({ select: err, insert: err, update: err, delete: err }),\n    order: () => ({ select: err }),\n    range: () => ({ select: err }),\n    maybeSingle: err,\n  })\n  return { auth: { getUser: err }, from }\n}\n\nexport const supabaseServer = supabaseServiceReady ? createClient(url, serviceKey) : createDisabledClient()\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,oFAA4C;AAChF,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,IAAI;AAErD,MAAM,uBAAuB,QAAQ,OAAO;AAEnD,SAAS;IACP,MAAM,MAAM;QAAc,MAAM,IAAI,MAAM;IAAmC;IAC7E,MAAM,OAAO,IAAM,CAAC;YAClB,QAAQ;YACR,QAAQ;YACR,QAAQ;YACR,QAAQ;YACR,IAAI,IAAM,CAAC;oBAAE,QAAQ;oBAAK,QAAQ;oBAAK,QAAQ;oBAAK,QAAQ;gBAAI,CAAC;YACjE,OAAO,IAAM,CAAC;oBAAE,QAAQ;gBAAI,CAAC;YAC7B,OAAO,IAAM,CAAC;oBAAE,QAAQ;gBAAI,CAAC;YAC7B,aAAa;QACf,CAAC;IACD,OAAO;QAAE,MAAM;YAAE,SAAS;QAAI;QAAG;IAAK;AACxC;AAEO,MAAM,iBAAiB,uBAAuB,IAAA,iKAAY,EAAC,KAAK,cAAc","debugId":null}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/adminAuth.ts"],"sourcesContent":["import type { NextApiRequest } from 'next';\nimport { supabaseServer } from './supabaseServer';\n\nexport type AdminCheck = { ok: boolean; userId?: string; error?: string };\n\nexport async function requireAdmin(req: NextApiRequest): Promise<AdminCheck> {\n  try {\n    const auth = String(req.headers.authorization || '');\n    const token = auth.startsWith('Bearer ') ? auth.slice(7) : '';\n    if (!token) return { ok: false, error: 'Missing Authorization bearer token' };\n\n    const { data: userData, error: userErr } = await supabaseServer.auth.getUser(token);\n    if (userErr || !userData?.user?.id) return { ok: false, error: 'Invalid token' };\n    const userId = userData.user.id;\n\n    const { data: profile, error } = await supabaseServer\n      .from('profiles')\n      .select('role,is_admin')\n      .eq('user_id', userId)\n      .maybeSingle();\n    if (error) return { ok: false, error: 'Profile lookup failed' };\n    const role = String(profile?.role || '').toLowerCase();\n    const isAdmin = Boolean(profile?.is_admin) || role === 'admin';\n    if (!isAdmin) return { ok: false, error: 'Forbidden' };\n    return { ok: true, userId };\n  } catch (e: any) {\n    return { ok: false, error: e?.message || 'Admin check failed' };\n  }\n}\n\n"],"names":[],"mappings":";;;;AACA;;AAIO,eAAe,aAAa,GAAmB;IACpD,IAAI;QACF,MAAM,OAAO,OAAO,IAAI,OAAO,CAAC,aAAa,IAAI;QACjD,MAAM,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;QAC3D,IAAI,CAAC,OAAO,OAAO;YAAE,IAAI;YAAO,OAAO;QAAqC;QAE5E,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,gIAAc,CAAC,IAAI,CAAC,OAAO,CAAC;QAC7E,IAAI,WAAW,CAAC,UAAU,MAAM,IAAI,OAAO;YAAE,IAAI;YAAO,OAAO;QAAgB;QAC/E,MAAM,SAAS,SAAS,IAAI,CAAC,EAAE;QAE/B,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,gIAAc,CAClD,IAAI,CAAC,YACL,MAAM,CAAC,iBACP,EAAE,CAAC,WAAW,QACd,WAAW;QACd,IAAI,OAAO,OAAO;YAAE,IAAI;YAAO,OAAO;QAAwB;QAC9D,MAAM,OAAO,OAAO,SAAS,QAAQ,IAAI,WAAW;QACpD,MAAM,UAAU,QAAQ,SAAS,aAAa,SAAS;QACvD,IAAI,CAAC,SAAS,OAAO;YAAE,IAAI;YAAO,OAAO;QAAY;QACrD,OAAO;YAAE,IAAI;YAAM;QAAO;IAC5B,EAAE,OAAO,GAAQ;QACf,OAAO;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAqB;IAChE;AACF","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/pages/api/admin/storage/kyc-init.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\nimport { requireAdmin } from '../../../../lib/adminAuth'\nimport { supabaseServer } from '../../../../lib/supabaseServer'\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') return res.status(405).json({ error: 'method_not_allowed' })\n  const admin = await requireAdmin(req)\n  if (!admin.ok) return res.status(401).json({ error: admin.error || 'unauthorized' })\n\n  try {\n    const name = 'kyc'\n    const existing = await (supabaseServer.storage as any).getBucket?.(name)\n    if (existing?.data?.name === name) {\n      await (supabaseServer.storage as any).updateBucket?.(name, {\n        public: false,\n        fileSizeLimit: '10MB',\n        allowedMimeTypes: ['image/jpeg','image/png','application/pdf','application/json','text/plain']\n      })\n      return res.json({ ok: true, bucket: name, updated: true })\n    }\n    const created = await (supabaseServer.storage as any).createBucket?.(name, {\n      public: false,\n      fileSizeLimit: '10MB',\n      allowedMimeTypes: ['image/jpeg','image/png','application/pdf','application/json','text/plain']\n    })\n    if (created?.error) return res.status(500).json({ error: String(created.error.message || 'create_failed') })\n    return res.json({ ok: true, bucket: name, created: true })\n  } catch (e: any) {\n    return res.status(500).json({ error: e?.message || 'server_error' })\n  }\n}\n\nexport const config = { api: { bodyParser: false } }\n"],"names":[],"mappings":";;;;;;AACA;AACA;;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IACpF,MAAM,QAAQ,MAAM,IAAA,yHAAY,EAAC;IACjC,IAAI,CAAC,MAAM,EAAE,EAAE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO,MAAM,KAAK,IAAI;IAAe;IAElF,IAAI;QACF,MAAM,OAAO;QACb,MAAM,WAAW,MAAM,AAAC,gIAAc,CAAC,OAAO,CAAS,SAAS,GAAG;QACnE,IAAI,UAAU,MAAM,SAAS,MAAM;YACjC,MAAM,AAAC,gIAAc,CAAC,OAAO,CAAS,YAAY,GAAG,MAAM;gBACzD,QAAQ;gBACR,eAAe;gBACf,kBAAkB;oBAAC;oBAAa;oBAAY;oBAAkB;oBAAmB;iBAAa;YAChG;YACA,OAAO,IAAI,IAAI,CAAC;gBAAE,IAAI;gBAAM,QAAQ;gBAAM,SAAS;YAAK;QAC1D;QACA,MAAM,UAAU,MAAM,AAAC,gIAAc,CAAC,OAAO,CAAS,YAAY,GAAG,MAAM;YACzE,QAAQ;YACR,eAAe;YACf,kBAAkB;gBAAC;gBAAa;gBAAY;gBAAkB;gBAAmB;aAAa;QAChG;QACA,IAAI,SAAS,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,OAAO,QAAQ,KAAK,CAAC,OAAO,IAAI;QAAiB;QAC1G,OAAO,IAAI,IAAI,CAAC;YAAE,IAAI;YAAM,QAAQ;YAAM,SAAS;QAAK;IAC1D,EAAE,OAAO,GAAQ;QACf,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,GAAG,WAAW;QAAe;IACpE;AACF;AAEO,MAAM,SAAS;IAAE,KAAK;QAAE,YAAY;IAAM;AAAE","debugId":null}}]
}