{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst url = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\nexport const supabaseServer = createClient(url, serviceKey);\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,oFAA4C;AAChF,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,iBAAiB,4PAAiD;AAEnI,MAAM,iBAAiB,IAAA,iKAAY,EAAC,KAAK","debugId":null}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/adminAuth.ts"],"sourcesContent":["import type { NextApiRequest } from 'next';\nimport { supabaseServer } from './supabaseServer';\n\nexport type AdminCheck = { ok: boolean; userId?: string; error?: string };\n\nexport async function requireAdmin(req: NextApiRequest): Promise<AdminCheck> {\n  try {\n    const auth = String(req.headers.authorization || '');\n    const token = auth.startsWith('Bearer ') ? auth.slice(7) : '';\n    if (!token) return { ok: false, error: 'Missing Authorization bearer token' };\n\n    const { data: userData, error: userErr } = await supabaseServer.auth.getUser(token);\n    if (userErr || !userData?.user?.id) return { ok: false, error: 'Invalid token' };\n    const userId = userData.user.id;\n\n    const { data: profile, error } = await supabaseServer\n      .from('profiles')\n      .select('role,is_admin')\n      .eq('user_id', userId)\n      .maybeSingle();\n    if (error) return { ok: false, error: 'Profile lookup failed' };\n    const role = String(profile?.role || '').toLowerCase();\n    const isAdmin = Boolean(profile?.is_admin) || role === 'admin';\n    if (!isAdmin) return { ok: false, error: 'Forbidden' };\n    return { ok: true, userId };\n  } catch (e: any) {\n    return { ok: false, error: e?.message || 'Admin check failed' };\n  }\n}\n\n"],"names":[],"mappings":";;;;AACA;;AAIO,eAAe,aAAa,GAAmB;IACpD,IAAI;QACF,MAAM,OAAO,OAAO,IAAI,OAAO,CAAC,aAAa,IAAI;QACjD,MAAM,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;QAC3D,IAAI,CAAC,OAAO,OAAO;YAAE,IAAI;YAAO,OAAO;QAAqC;QAE5E,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,mLAAc,CAAC,IAAI,CAAC,OAAO,CAAC;QAC7E,IAAI,WAAW,CAAC,UAAU,MAAM,IAAI,OAAO;YAAE,IAAI;YAAO,OAAO;QAAgB;QAC/E,MAAM,SAAS,SAAS,IAAI,CAAC,EAAE;QAE/B,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,mLAAc,CAClD,IAAI,CAAC,YACL,MAAM,CAAC,iBACP,EAAE,CAAC,WAAW,QACd,WAAW;QACd,IAAI,OAAO,OAAO;YAAE,IAAI;YAAO,OAAO;QAAwB;QAC9D,MAAM,OAAO,OAAO,SAAS,QAAQ,IAAI,WAAW;QACpD,MAAM,UAAU,QAAQ,SAAS,aAAa,SAAS;QACvD,IAAI,CAAC,SAAS,OAAO;YAAE,IAAI;YAAO,OAAO;QAAY;QACrD,OAAO;YAAE,IAAI;YAAM;QAAO;IAC5B,EAAE,OAAO,GAAQ;QACf,OAAO;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAqB;IAChE;AACF","debugId":null}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/pages/api/admin/users/promote.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { z } from 'zod';\nimport { supabaseServer } from '../../../../lib/supabaseServer';\nimport { requireAdmin } from '../../../../lib/adminAuth';\n\nconst BodySchema = z.object({ userId: z.string().uuid() });\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' });\n  const admin = await requireAdmin(req);\n  if (!admin.ok) return res.status(401).json({ error: admin.error || 'Unauthorized' });\n  const parse = BodySchema.safeParse(req.body || {});\n  if (!parse.success) return res.status(400).json({ error: 'Invalid payload', issues: parse.error.issues });\n  const { userId } = parse.data;\n\n  try {\n    const payload = { user_id: userId, role: 'admin', is_admin: true };\n    const { data, error } = await supabaseServer\n      .from('profiles')\n      .upsert(payload, { onConflict: 'user_id' })\n      .select()\n      .maybeSingle();\n    if (error) return res.status(500).json({ ok: false, error: 'Failed to promote user', details: error.message });\n    return res.status(200).json({ ok: true, profile: data });\n  } catch (e: any) {\n    return res.status(500).json({ ok: false, error: e?.message || 'Promotion failed' });\n  }\n}\n\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;;;;;AAEA,MAAM,aAAa,2GAAC,CAAC,MAAM,CAAC;IAAE,QAAQ,2GAAC,CAAC,MAAM,GAAG,IAAI;AAAG;AAEzC,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IACrF,MAAM,QAAQ,MAAM,IAAA,4KAAY,EAAC;IACjC,IAAI,CAAC,MAAM,EAAE,EAAE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO,MAAM,KAAK,IAAI;IAAe;IAClF,MAAM,QAAQ,WAAW,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC;IAChD,IAAI,CAAC,MAAM,OAAO,EAAE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;QAAmB,QAAQ,MAAM,KAAK,CAAC,MAAM;IAAC;IACvG,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI;IAE7B,IAAI;QACF,MAAM,UAAU;YAAE,SAAS;YAAQ,MAAM;YAAS,UAAU;QAAK;QACjE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,mLAAc,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,SAAS;YAAE,YAAY;QAAU,GACxC,MAAM,GACN,WAAW;QACd,IAAI,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;YAA0B,SAAS,MAAM,OAAO;QAAC;QAC5G,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAK;IACxD,EAAE,OAAO,GAAQ;QACf,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAmB;IACnF;AACF","debugId":null}}]
}