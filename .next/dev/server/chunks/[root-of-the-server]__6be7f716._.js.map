{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/pages/api/referral.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport crypto from 'crypto';\nimport { createClient } from '@supabase/supabase-js';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' });\n  const { userId, amountUSD = 0 } = req.body || {};\n  if (!userId) return res.status(400).json({ error: 'Missing userId' });\n\n  // Generate referral code\n  const referralCode = crypto.createHash('sha256').update(`${userId}:${Date.now()}`).digest('hex').slice(0, 8);\n  // Placeholder: Track commission and auto-credit to downline wallets\n  const creditedUSD = Number((amountUSD * 0.05).toFixed(2)); // 5% placeholder\n\n  // Try persisting to Supabase if environment is configured\n  const url = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const key = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n  if (url && key) {\n    const supabase = createClient(url, key);\n    try {\n      await supabase\n        .from('referrals')\n        .upsert({ user_id: userId, code: referralCode }, { onConflict: 'user_id' });\n    } catch (e) {\n      // swallow insert errors to keep API responsive\n    }\n  }\n\n  return res.status(200).json({ ok: true, referralCode, creditedUSD });\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IACrF,MAAM,EAAE,MAAM,EAAE,YAAY,CAAC,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;IAC/C,IAAI,CAAC,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAiB;IAEnE,yBAAyB;IACzB,MAAM,eAAe,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,IAAI,EAAE,MAAM,CAAC,OAAO,KAAK,CAAC,GAAG;IAC1G,oEAAoE;IACpE,MAAM,cAAc,OAAO,CAAC,YAAY,IAAI,EAAE,OAAO,CAAC,KAAK,iBAAiB;IAE5E,0DAA0D;IAC1D,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY;IACpC,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,iBAAiB;IAClF,wCAAgB;QACd,MAAM,WAAW,IAAA,iKAAY,EAAC,KAAK;QACnC,IAAI;YACF,MAAM,SACH,IAAI,CAAC,aACL,MAAM,CAAC;gBAAE,SAAS;gBAAQ,MAAM;YAAa,GAAG;gBAAE,YAAY;YAAU;QAC7E,EAAE,OAAO,GAAG;QACV,+CAA+C;QACjD;IACF;IAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAM;QAAc;IAAY;AACpE","debugId":null}}]
}