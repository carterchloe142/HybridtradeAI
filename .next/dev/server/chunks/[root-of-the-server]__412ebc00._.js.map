{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst url = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\nexport const supabaseServer = createClient(url, serviceKey);\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,oFAA4C;AAChF,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,iBAAiB,4PAAiD;AAEnI,MAAM,iBAAiB,IAAA,iKAAY,EAAC,KAAK","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/lib/rateLimit.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\n\ntype LimiterOptions = { windowMs: number; max: number };\ntype Hit = { count: number; resetAt: number };\n\nconst store = new Map<string, Hit>();\n\nfunction getIp(req: NextApiRequest) {\n  const xfwd = (req.headers['x-forwarded-for'] || '') as string;\n  const ip = xfwd.split(',')[0].trim();\n  return ip || (req.socket as any)?.remoteAddress || 'unknown';\n}\n\nexport function createRateLimiter(opts: LimiterOptions) {\n  return async function check(req: NextApiRequest, res: NextApiResponse, key: string) {\n    const ip = getIp(req);\n    const id = `${ip}:${key}`;\n    const now = Date.now();\n    const hit = store.get(id);\n    if (!hit || now > hit.resetAt) {\n      store.set(id, { count: 1, resetAt: now + opts.windowMs });\n      res.setHeader('X-RateLimit-Remaining', String(opts.max - 1));\n      return true;\n    }\n    if (hit.count >= opts.max) {\n      const retryMs = hit.resetAt - now;\n      res.setHeader('Retry-After', String(Math.ceil(retryMs / 1000)));\n      res.status(429).json({ error: 'Too many requests' });\n      return false;\n    }\n    hit.count += 1;\n    store.set(id, hit);\n    res.setHeader('X-RateLimit-Remaining', String(opts.max - hit.count));\n    return true;\n  };\n}\n"],"names":[],"mappings":";;;;AAKA,MAAM,QAAQ,IAAI;AAElB,SAAS,MAAM,GAAmB;IAChC,MAAM,OAAQ,IAAI,OAAO,CAAC,kBAAkB,IAAI;IAChD,MAAM,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAClC,OAAO,MAAO,IAAI,MAAM,EAAU,iBAAiB;AACrD;AAEO,SAAS,kBAAkB,IAAoB;IACpD,OAAO,eAAe,MAAM,GAAmB,EAAE,GAAoB,EAAE,GAAW;QAChF,MAAM,KAAK,MAAM;QACjB,MAAM,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK;QACzB,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,MAAM,MAAM,GAAG,CAAC;QACtB,IAAI,CAAC,OAAO,MAAM,IAAI,OAAO,EAAE;YAC7B,MAAM,GAAG,CAAC,IAAI;gBAAE,OAAO;gBAAG,SAAS,MAAM,KAAK,QAAQ;YAAC;YACvD,IAAI,SAAS,CAAC,yBAAyB,OAAO,KAAK,GAAG,GAAG;YACzD,OAAO;QACT;QACA,IAAI,IAAI,KAAK,IAAI,KAAK,GAAG,EAAE;YACzB,MAAM,UAAU,IAAI,OAAO,GAAG;YAC9B,IAAI,SAAS,CAAC,eAAe,OAAO,KAAK,IAAI,CAAC,UAAU;YACxD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAoB;YAClD,OAAO;QACT;QACA,IAAI,KAAK,IAAI;QACb,MAAM,GAAG,CAAC,IAAI;QACd,IAAI,SAAS,CAAC,yBAAyB,OAAO,KAAK,GAAG,GAAG,IAAI,KAAK;QAClE,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/pages/api/deposit.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { supabaseServer } from '../../lib/supabaseServer';\nimport { createRateLimiter } from '../../lib/rateLimit';\nimport { z } from 'zod';\n\nconst DepositSchema = z.object({\n  userId: z.string().min(1),\n  amount: z.number().positive(),\n  currency: z.enum(['USD', 'EUR', 'NGN', 'BTC', 'ETH']),\n  provider: z.string().min(1),\n  planId: z.enum(['starter', 'pro', 'elite'])\n});\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' });\n  const limiter = createRateLimiter({\n    windowMs: Number(process.env.RATE_LIMIT_WINDOW_MS ?? 15_000),\n    max: Number(process.env.RATE_LIMIT_MAX ?? 20)\n  });\n  const ok = await limiter(req, res, 'deposit');\n  if (!ok) return;\n  const parsed = DepositSchema.safeParse(req.body || {});\n  if (!parsed.success) return res.status(400).json({ error: 'Invalid payload', issues: parsed.error.issues });\n  const { userId, amount, currency, provider, planId } = parsed.data;\n\n  // Record transaction\n  const { error: txErr } = await supabaseServer.from('transactions').insert({\n    user_id: userId,\n    type: 'deposit',\n    amount_usd: amount,\n    meta: { provider, currency, planId }\n  });\n  if (txErr) return res.status(500).json({ error: 'Failed to record transaction', details: txErr.message });\n\n  // Create investment (active)\n  const { error: invErr } = await supabaseServer\n    .from('investments')\n    .insert({ user_id: userId, plan_id: planId, amount_usd: amount, status: 'active' });\n  if (invErr) return res.status(500).json({ error: 'Failed to create investment' });\n\n  return res.status(200).json({ ok: true, message: `Deposit of ${amount} ${currency} via ${provider} recorded for plan ${planId}.` });\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;;;;;AAEA,MAAM,gBAAgB,2GAAC,CAAC,MAAM,CAAC;IAC7B,QAAQ,2GAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,QAAQ,2GAAC,CAAC,MAAM,GAAG,QAAQ;IAC3B,UAAU,2GAAC,CAAC,IAAI,CAAC;QAAC;QAAO;QAAO;QAAO;QAAO;KAAM;IACpD,UAAU,2GAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,QAAQ,2GAAC,CAAC,IAAI,CAAC;QAAC;QAAW;QAAO;KAAQ;AAC5C;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IACrF,MAAM,UAAU,IAAA,iLAAiB,EAAC;QAChC,UAAU,OAAO,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACrD,KAAK,OAAO,QAAQ,GAAG,CAAC,cAAc,IAAI;IAC5C;IACA,MAAM,KAAK,MAAM,QAAQ,KAAK,KAAK;IACnC,IAAI,CAAC,IAAI;IACT,MAAM,SAAS,cAAc,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC;IACpD,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;QAAmB,QAAQ,OAAO,KAAK,CAAC,MAAM;IAAC;IACzG,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,OAAO,IAAI;IAElE,qBAAqB;IACrB,MAAM,EAAE,OAAO,KAAK,EAAE,GAAG,MAAM,mLAAc,CAAC,IAAI,CAAC,gBAAgB,MAAM,CAAC;QACxE,SAAS;QACT,MAAM;QACN,YAAY;QACZ,MAAM;YAAE;YAAU;YAAU;QAAO;IACrC;IACA,IAAI,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;QAAgC,SAAS,MAAM,OAAO;IAAC;IAEvG,6BAA6B;IAC7B,MAAM,EAAE,OAAO,MAAM,EAAE,GAAG,MAAM,mLAAc,CAC3C,IAAI,CAAC,eACL,MAAM,CAAC;QAAE,SAAS;QAAQ,SAAS;QAAQ,YAAY;QAAQ,QAAQ;IAAS;IACnF,IAAI,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAA8B;IAE/E,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAM,SAAS,CAAC,WAAW,EAAE,OAAO,CAAC,EAAE,SAAS,KAAK,EAAE,SAAS,mBAAmB,EAAE,OAAO,CAAC,CAAC;IAAC;AACnI","debugId":null}}]
}