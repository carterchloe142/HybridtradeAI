{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/src/hooks/useUserNotifications.ts"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react'\n\ntype NotificationItem = {\n  id: string\n  type: string\n  title: string\n  message: string\n  link?: string\n  read?: boolean\n  createdAt?: string\n}\n\nexport function useUserNotifications(userId?: string) {\n  const [items, setItems] = useState<NotificationItem[]>([])\n  const [connected, setConnected] = useState(false)\n  const bcRef = useRef<BroadcastChannel | null>(null)\n  const leaderRef = useRef(false)\n  const esRef = useRef<EventSource | null>(null)\n  const lastIdKey = useMemo(() => (userId ? `notifications:lastId:${userId}` : 'notifications:lastId'), [userId])\n\n  useEffect(() => {\n    let mounted = true\n    const bc = new BroadcastChannel('notifications:user')\n    bcRef.current = bc\n\n    function onEvent(data: any) {\n      const id = String(data?.id || '')\n      if (!id) return\n      setItems((prev) => {\n        const exists = prev.some((p) => String(p.id) === id)\n        const next = exists ? prev.map((p) => (String(p.id) === id ? { ...p, ...data } : p)) : [data as NotificationItem, ...prev]\n        return next\n      })\n      try { localStorage.setItem(lastIdKey, id) } catch {}\n    }\n\n    function becomeLeader() {\n      if (leaderRef.current) return\n      if (!mounted) return\n      leaderRef.current = true\n      const channel = bcRef.current ?? new BroadcastChannel('notifications:user')\n      bcRef.current = channel\n      try { channel.postMessage({ t: 'leader' }) } catch {}\n      const lastEventId = (() => { try { return localStorage.getItem(lastIdKey) || '' } catch { return '' } })()\n      const url = lastEventId ? `/api/user/notifications/stream?lastEventId=${encodeURIComponent(lastEventId)}` : `/api/user/notifications/stream`\n      const es = new EventSource(url)\n      esRef.current = es\n      es.onopen = () => { if (mounted) setConnected(true) }\n      es.onmessage = (ev) => {\n        try { const data = JSON.parse(ev.data); onEvent(data); bc.postMessage({ t: 'event', data }) } catch {}\n      }\n      es.onerror = () => {}\n    }\n\n    let heardLeader = false\n    bc.onmessage = (ev) => {\n      const msg = ev.data || {}\n      if (!mounted) return\n      if (msg.t === 'leader') { heardLeader = true }\n      if (msg.t === 'event') { onEvent(msg.data) }\n    }\n    try { bc.postMessage({ t: 'who' }) } catch {}\n    const leaderTimeout = setTimeout(() => { if (!heardLeader) becomeLeader() }, 400)\n\n    ;(async () => {\n      try {\n        const res = await fetch('/api/user/notifications?limit=50&unreadOnly=false')\n        const json = await res.json()\n        if (!mounted) return\n        const list: NotificationItem[] = Array.isArray(json?.items) ? json.items : []\n        setItems(list)\n      } catch {}\n    })()\n\n    return () => {\n      mounted = false\n      try { bc.close() } catch {}\n      try { esRef.current?.close() } catch {}\n      try { clearTimeout(leaderTimeout) } catch {}\n    }\n  }, [lastIdKey, userId])\n\n  const unreadCount = useMemo(() => items.filter((i) => !i.read).length, [items])\n\n  async function markRead(ids: string[]) {\n    if (!ids?.length) return\n    const prev = items\n    setItems((curr) => curr.map((c) => (ids.includes(String(c.id)) ? { ...c, read: true } : c)))\n    try {\n      const res = await fetch('/api/user/notifications/mark-read', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ ids }) })\n      if (!res.ok) throw new Error('failed')\n    } catch {\n      setItems(prev)\n    }\n  }\n\n  return { items, connected, unreadCount, markRead }\n}\n\nexport function useUnreadCount() {\n  const { unreadCount } = useUserNotifications()\n  return unreadCount\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/app/components/NotificationBell.tsx"],"sourcesContent":["\"use client\"\nimport { Bell } from 'lucide-react'\nimport { useUserNotifications, useUnreadCount } from '../../src/hooks/useUserNotifications'\n\ntype Props = { variant?: 'user' | 'admin' }\n\nexport default function NotificationBell({ variant = 'user' }: Props) {\n  const unread = useUnreadCount()\n  const { connected } = useUserNotifications()\n\n  return (\n    <div className=\"relative\">\n      <button className=\"relative inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 transition-colors\">\n        <Bell className=\"w-5 h-5 text-neon-blue\" />\n        {connected && (\n          <span className=\"absolute -bottom-1 -right-1 text-[10px] px-1.5 py-0.5 rounded bg-green-500 text-white\">live</span>\n        )}\n      </button>\n      {unread > 0 && (\n        <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 px-1.5 rounded-full bg-neon-pink text-white text-xs flex items-center justify-center animate-pulse\">\n          {unread}\n        </span>\n      )}\n    </div>\n  )\n}\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAMe,SAAS,iBAAiB,EAAE,UAAU,MAAM,EAAS;IAClE,MAAM,SAAS,IAAA,kMAAc;IAC7B,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,wMAAoB;IAE1C,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAO,WAAU;;kCAChB,qKAAC,sPAAI;wBAAC,WAAU;;;;;;oBACf,2BACC,qKAAC;wBAAK,WAAU;kCAAwF;;;;;;;;;;;;YAG3G,SAAS,mBACR,qKAAC;gBAAK,WAAU;0BACb;;;;;;;;;;;;AAKX","debugId":null}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/components/Navbar.tsx"],"sourcesContent":["import Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport { useState } from 'react';\nimport { Menu, X, Bot } from 'lucide-react';\nimport NotificationBell from '../app/components/NotificationBell';\n\nexport default function Navbar() {\n  const router = useRouter();\n  const [open, setOpen] = useState(false);\n\n  return (\n    <nav className=\"w-full sticky top-0 z-30 bg-[#0a0f1b]/70 backdrop-blur-md border-b border-white/10\">\n      <div className=\"container-xl px-4 py-3 flex items-center justify-between\">\n        <Link href=\"/\" className=\"flex items-center gap-2\">\n          <Bot className=\"text-neon-blue\" />\n          <span className=\"font-bold text-xl neon-text\">HybridTradeAI</span>\n        </Link>\n\n        <div className=\"hidden md:flex items-center gap-6\">\n          <Link href=\"/plans\" className=\"hover:text-neon-blue\">Plans</Link>\n          <Link href=\"/dashboard\" className=\"hover:text-neon-blue\">Dashboard</Link>\n          <NotificationBell />\n          <Link href=\"/auth/login\" className=\"btn-neon\">Login</Link>\n        </div>\n\n        <button aria-label=\"Toggle menu\" className=\"md:hidden\" onClick={() => setOpen(!open)}>\n          {open ? <X /> : <Menu />}\n        </button>\n      </div>\n\n      {open && (\n        <div className=\"md:hidden px-4 pb-4 flex flex-col gap-3\">\n          <Link href=\"/plans\" onClick={() => setOpen(false)} className=\"hover:text-neon-blue\">Plans</Link>\n          <Link href=\"/dashboard\" onClick={() => setOpen(false)} className=\"hover:text-neon-blue\">Dashboard</Link>\n          <Link href=\"/auth/login\" onClick={() => setOpen(false)} className=\"btn-neon text-center\">Login</Link>\n        </div>\n      )}\n    </nav>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,uLAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC;IAEjC,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC,mLAAI;wBAAC,MAAK;wBAAI,WAAU;;0CACvB,qKAAC,mPAAG;gCAAC,WAAU;;;;;;0CACf,qKAAC;gCAAK,WAAU;0CAA8B;;;;;;;;;;;;kCAGhD,qKAAC;wBAAI,WAAU;;0CACb,qKAAC,mLAAI;gCAAC,MAAK;gCAAS,WAAU;0CAAuB;;;;;;0CACrD,qKAAC,mLAAI;gCAAC,MAAK;gCAAa,WAAU;0CAAuB;;;;;;0CACzD,qKAAC,6LAAgB;;;;;0CACjB,qKAAC,mLAAI;gCAAC,MAAK;gCAAc,WAAU;0CAAW;;;;;;;;;;;;kCAGhD,qKAAC;wBAAO,cAAW;wBAAc,WAAU;wBAAY,SAAS,IAAM,QAAQ,CAAC;kCAC5E,qBAAO,qKAAC,6OAAC;;;;iDAAM,qKAAC,sPAAI;;;;;;;;;;;;;;;;YAIxB,sBACC,qKAAC;gBAAI,WAAU;;kCACb,qKAAC,mLAAI;wBAAC,MAAK;wBAAS,SAAS,IAAM,QAAQ;wBAAQ,WAAU;kCAAuB;;;;;;kCACpF,qKAAC,mLAAI;wBAAC,MAAK;wBAAa,SAAS,IAAM,QAAQ;wBAAQ,WAAU;kCAAuB;;;;;;kCACxF,qKAAC,mLAAI;wBAAC,MAAK;wBAAc,SAAS,IAAM,QAAQ;wBAAQ,WAAU;kCAAuB;;;;;;;;;;;;;;;;;;AAKnG","debugId":null}},
    {"offset": {"line": 420, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/trae_projects/HYBRID%20TRADE%20AI/pages/_app.tsx"],"sourcesContent":["import type { AppProps } from 'next/app';\nimport '../styles/globals.css';\nimport Navbar from '../components/Navbar';\n\nexport default function App({ Component, pageProps }: AppProps) {\n  return (\n    <div className=\"min-h-screen\">\n      <Navbar />\n      <main className=\"container-xl px-4 py-6\">\n        <Component {...pageProps} />\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEe,SAAS,IAAI,EAAE,SAAS,EAAE,SAAS,EAAY;IAC5D,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC,4KAAM;;;;;0BACP,qKAAC;gBAAK,WAAU;0BACd,cAAA,qKAAC;oBAAW,GAAG,SAAS;;;;;;;;;;;;;;;;;AAIhC","debugId":null}}]
}