module.exports=[94131,(e,t,a)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var a=e.i(94131);let r=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||"",s=!!(r&&i),n=s?(0,a.createClient)(r,i):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,n,"supabaseServiceReady",0,s])},56798,e=>{"use strict";var t=e.i(30772);async function a(e){try{let a=String(e.headers.authorization||""),r=a.startsWith("Bearer ")?a.slice(7):"";if(!r)return{ok:!1,error:"Missing Authorization bearer token"};let{data:i,error:s}=await t.supabaseServer.auth.getUser(r);if(s||!i?.user?.id)return{ok:!1,error:"Invalid token"};let n=i.user.id,{data:d,error:o}=await t.supabaseServer.from("profiles").select("role,is_admin").eq("user_id",n).maybeSingle();if(o)return{ok:!1,error:"Profile lookup failed"};let u=String(d?.role||"").toLowerCase();if(!(d?.is_admin||"admin"===u))return{ok:!1,error:"Forbidden"};return{ok:!0,userId:n}}catch(e){return{ok:!1,error:e?.message||"Admin check failed"}}}e.s(["requireAdmin",()=>a])},20304,e=>{"use strict";var t=e.i(26747),a=e.i(90406),r=e.i(44898),i=e.i(62950),s=e.i(30772);let n=[{id:"starter",name:"Starter",description:"Entry plan allocating 70% Ads & Tasks and 30% Trading.",weeklyRoi:30,features:["70% Ads & Tasks","30% Trading","Task bonuses available"]},{id:"pro",name:"Pro",description:"Balanced plan: 60% Trading, 25% Copy-Trading, 15% Ads & Tasks.",weeklyRoi:35,features:["60% Trading","25% Copy-Trading","15% Ads & Tasks","Premium education content"]},{id:"elite",name:"Elite",description:"High-tier: 50% Trading, 30% Staking/Yield, 20% AI/Copy-Trading.",weeklyRoi:40,features:["Priority withdrawals","Beta access to new features","50% Trading","30% Staking/Yield","20% AI/Copy-Trading"]}];var d=e.i(56798);function o(e,t){let a=new Date(e);return a.setDate(a.getDate()+t),a}async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let a=await (0,d.requireAdmin)(e);if(!a.ok)return t.status(401).json({error:a.error||"Unauthorized"});let r=Number(process.env.SERVICE_FEE_PCT??5),{data:i,error:u}=await s.supabaseServer.from("investments").select("id,user_id,plan_id,amount_usd,status,created_at").eq("status","active");if(u)return t.status(500).json({error:"Failed to fetch investments"});let l=new Date,p=[];for(let e of i||[]){e.created_at;let t=o(e.created_at,7),a=o(e.created_at,14),{data:i}=await s.supabaseServer.from("transactions").select("id").eq("user_id",e.user_id).eq("type","roi").contains("meta",{investment_id:e.id}).limit(1);if(l>=t&&(!i||0===i.length)){let t=function(e){let t=n.find(t=>t.id===e);return t?.weeklyRoi??0}(e.plan_id),a=Number(((function(e,t){let a=n.find(e=>e.id===t);return a?Number((e*(a.weeklyRoi/100)).toFixed(2)):0})(e.amount_usd,e.plan_id)*(1-r/100)).toFixed(2)),{data:i}=await s.supabaseServer.from("wallets").select("id,amount").eq("user_id",e.user_id).eq("currency","USD").maybeSingle();i?.id?await s.supabaseServer.from("wallets").update({amount:Number(i.amount)+a}).eq("id",i.id):await s.supabaseServer.from("wallets").insert({user_id:e.user_id,currency:"USD",amount:a}),await s.supabaseServer.from("transactions").insert({user_id:e.user_id,type:"roi",amount_usd:a,meta:{investment_id:e.id,applied_weekly_roi:t,service_fee_pct:r}}),p.push({investmentId:e.id,action:"roi_credited",net:a})}let{data:d}=await s.supabaseServer.from("transactions").select("id").eq("user_id",e.user_id).eq("type","principal_release").contains("meta",{investment_id:e.id}).limit(1);if(l>=a&&(!d||0===d.length)){let{data:t}=await s.supabaseServer.from("wallets").select("id,amount").eq("user_id",e.user_id).eq("currency","USD").maybeSingle();t?.id?await s.supabaseServer.from("wallets").update({amount:Number(t.amount)+Number(e.amount_usd)}).eq("id",t.id):await s.supabaseServer.from("wallets").insert({user_id:e.user_id,currency:"USD",amount:e.amount_usd}),await s.supabaseServer.from("transactions").insert({user_id:e.user_id,type:"principal_release",amount_usd:e.amount_usd,meta:{investment_id:e.id}}),await s.supabaseServer.from("investments").update({status:"completed"}).eq("id",e.id),p.push({investmentId:e.id,action:"principal_released",amount:e.amount_usd})}}return t.status(200).json({ok:!0,results:p})}e.s(["default",()=>u],24502);var l=e.i(24502),p=e.i(7031),c=e.i(81927),m=e.i(46432);let f=(0,i.hoist)(l,"default"),_=(0,i.hoist)(l,"config"),v=new r.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/admin/run-cycle",pathname:"/api/admin/run-cycle",bundlePath:"",filename:""},userland:l,distDir:".next",relativeProjectDir:""});async function w(e,a,r){v.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/run-cycle";i=i.replace(/\/index$/,"")||"/";let s=await v.prepare(e,a,{srcPage:i});if(!s){a.statusCode=400,a.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:n,params:d,prerenderManifest:o,routerServerContext:u}=s;try{let t=e.method||"GET",r=(0,p.getTracer)(),s=r.getActiveScopeSpan(),l=v.instrumentationOnRequestError.bind(v),m=async s=>v.render(e,a,{query:{...n,...d},params:d,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:o.preview,propagateError:!1,dev:v.isDev,page:"/api/admin/run-cycle",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":a.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;s.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),s.updateName(e)}else s.updateName(`${t} ${i}`)});s?await m(s):await r.withPropagatedContext(e.headers,()=>r.trace(c.BaseServerSpan.handleRequest,{spanName:`${t} ${i}`,kind:p.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},m))}catch(e){if(v.isDev)throw e;(0,t.sendError)(a,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,_,"default",0,f,"handler",()=>w],20304)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a7678fee._.js.map