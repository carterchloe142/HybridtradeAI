module.exports=[59639,(e,t,r)=>{t.exports=e.x("node:process",()=>require("node:process"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},57764,(e,t,r)=>{t.exports=e.x("node:url",()=>require("node:url"))},4733,e=>e.a(async(t,r)=>{try{let t=await e.y("@prisma/client/runtime/library");e.n(t),r()}catch(e){r(e)}},!0),94131,(e,t,r)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var r=e.i(94131);let a=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"",i=!!(a&&s),n=i?(0,r.createClient)(a,s):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,n,"supabaseServiceReady",0,i])},56798,e=>{"use strict";var t=e.i(30772);async function r(e){try{let r=String(e.headers.authorization||""),a=r.startsWith("Bearer ")?r.slice(7):"";if(!a)return{ok:!1,error:"Missing Authorization bearer token"};let{data:s,error:i}=await t.supabaseServer.auth.getUser(a);if(i||!s?.user?.id)return{ok:!1,error:"Invalid token"};let n=s.user.id,{data:o,error:u}=await t.supabaseServer.from("profiles").select("role,is_admin").eq("user_id",n).maybeSingle();if(u)return{ok:!1,error:"Profile lookup failed"};let d=String(o?.role||"").toLowerCase();if(!(o?.is_admin||"admin"===d))return{ok:!1,error:"Forbidden"};return{ok:!0,userId:n}}catch(e){return{ok:!1,error:e?.message||"Admin check failed"}}}e.s(["requireAdmin",()=>r])},97010,e=>e.a(async(t,r)=>{try{let t=await e.y("zod");e.n(t),r()}catch(e){r(e)}},!0),23338,e=>e.a(async(t,r)=>{try{var a=e.i(97010),s=e.i(56798),i=e.i(30772),n=e.i(82911),o=t([a,n]);[a,n]=o.then?(await o)():o;let d=a.z.object({id:a.z.string().min(1),status:a.z.enum(["confirmed","rejected"])});async function u(t,r){if("GET"===t.method){let e=await (0,s.requireAdmin)(t);if(!e.ok)return r.status(401).json({error:e.error||"unauthorized"});let a=String(t.query.type||""),n=String(t.query.status||""),o={};a&&(o.type=a),n&&(o.status=n);let{data:u,error:d}=await i.supabaseServer.from("transactions").select("id,user_id,type,amount,amount_usd,currency,status,meta,created_at,profiles(email)").order("created_at",{ascending:!1});return d?r.status(500).json({error:"fetch_failed"}):r.json({items:u?.filter(e=>{let t=!a||String(e.type)===a,r=!n||String(e.status)===n;return t&&r})||[]})}if("PATCH"===t.method){let a=await (0,s.requireAdmin)(t);if(!a.ok)return r.status(401).json({error:a.error||"unauthorized"});let o=d.safeParse(t.body||{});if(!o.success)return r.status(400).json({error:"invalid_payload",issues:o.error.issues});let{id:u,status:l}=o.data,{data:c,error:p}=await i.supabaseServer.from("transactions").select("id,user_id,type,amount,amount_usd,currency,status,meta").eq("id",u).maybeSingle();if(p||!c)return r.status(404).json({error:"transaction_not_found"});let{error:m}=await i.supabaseServer.from("transactions").update({status:l}).eq("id",u);if(m)return r.status(500).json({error:"update_failed"});try{let t=Number(c.amount??c.amount_usd??0),r=String(c.currency||c?.meta?.currency||"USD"),a="confirmed"===l?`Your withdrawal of ${t} ${r} was approved.`:`Your withdrawal of ${t} ${r} was rejected.`,s=await n.default.notification.create({data:{userId:String(c.user_id),type:"withdrawal_status",title:"confirmed"===l?"Withdrawal Approved":"Withdrawal Rejected",message:a,read:!1}});try{let{publish:t}=await e.A(22530);await t(`user:${String(c.user_id)}`,{id:s.id,type:s.type,title:s.title,message:s.message,createdAt:s.createdAt})}catch{}}catch{}return r.json({ok:!0})}return r.status(405).json({error:"method_not_allowed"})}e.s(["config",0,{api:{bodyParser:!0}},"default",()=>u]),r()}catch(e){r(e)}},!1),1309,e=>e.a(async(t,r)=>{try{var a=e.i(26747),s=e.i(90406),i=e.i(44898),n=e.i(62950),o=e.i(23338),u=e.i(7031),d=e.i(81927),l=e.i(46432),c=t([o]);[o]=c.then?(await c)():c;let m=(0,n.hoist)(o,"default"),f=(0,n.hoist)(o,"config"),h=new i.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/admin/transactions",pathname:"/api/admin/transactions",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,r){h.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/admin/transactions";s=s.replace(/\/index$/,"")||"/";let i=await h.prepare(e,t,{srcPage:s});if(!i){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:n,params:o,prerenderManifest:c,routerServerContext:p}=i;try{let r=e.method||"GET",a=(0,u.getTracer)(),i=a.getActiveScopeSpan(),l=h.instrumentationOnRequestError.bind(h),m=async i=>h.render(e,t,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:h.isDev,page:"/api/admin/transactions",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${r} ${n}`;i.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),i.updateName(e)}else i.updateName(`${r} ${s}`)});i?await m(i):await a.withPropagatedContext(e.headers,()=>a.trace(d.BaseServerSpan.handleRequest,{spanName:`${r} ${s}`,kind:u.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(h.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,f,"default",0,m,"handler",()=>p]),r()}catch(e){r(e)}},!1),22530,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__39ab9f14._.js"].map(t=>e.l(t))).then(()=>t(57729)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8e34929f._.js.map