module.exports=[97010,e=>e.a(async(t,r)=>{try{let t=await e.y("zod");e.n(t),r()}catch(e){r(e)}},!0),94131,(e,t,r)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var r=e.i(94131);let a=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"",i=!!(a&&s),n=i?(0,r.createClient)(a,s):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,n,"supabaseServiceReady",0,i])},55750,e=>{"use strict";let t=new Map;function r(e){return async function(r,a,s){let i=(r.headers["x-forwarded-for"]||"").split(",")[0].trim()||r.socket?.remoteAddress||"unknown",n=`${i}:${s}`,o=Date.now(),u=t.get(n);if(!u||o>u.resetAt)return t.set(n,{count:1,resetAt:o+e.windowMs}),a.setHeader("X-RateLimit-Remaining",String(e.max-1)),!0;if(u.count>=e.max){let e=u.resetAt-o;return a.setHeader("Retry-After",String(Math.ceil(e/1e3))),a.status(429).json({error:"Too many requests"}),!1}return u.count+=1,t.set(n,u),a.setHeader("X-RateLimit-Remaining",String(e.max-u.count)),!0}}e.s(["createRateLimiter",()=>r])},5766,e=>{"use strict";var t=e.i(30772);async function r(e){let{data:r,error:a}=await t.supabaseServer.from("profiles").select("kyc_status").eq("user_id",e).maybeSingle();return a?null:r?.kyc_status??null}e.s(["getKycStatus",()=>r])},84459,e=>e.a(async(t,r)=>{try{var a=e.i(30772),s=e.i(55750),i=e.i(5766),n=e.i(97010),o=t([n]);[n]=o.then?(await o)():o;let l=n.z.object({userId:n.z.string().min(1),amount:n.z.number().positive(),currency:n.z.enum(["USD","EUR","NGN","BTC","ETH"]),cycleActive:n.z.boolean().optional()});async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=(0,s.createRateLimiter)({windowMs:Number(process.env.RATE_LIMIT_WINDOW_MS??15e3),max:Number(process.env.RATE_LIMIT_MAX??20)});if(!await r(e,t,"withdraw"))return;let n=l.safeParse(e.body||{});if(!n.success)return t.status(400).json({error:"Invalid payload",issues:n.error.issues});let{userId:o,amount:u,currency:d,cycleActive:c}=n.data,p=await (0,i.getKycStatus)(o);if("approved"!==p)return t.status(403).json({error:"KYC required. Please complete verification."});if(c)return t.status(400).json({error:"Withdrawal blocked: cycle in progress. Try after distribution."});let m=Number(process.env.WITHDRAW_HOLD_THRESHOLD_USD??2e3);if(Number(u)>m)return await a.supabaseServer.from("transactions").insert({user_id:o,type:"withdraw_request",amount_usd:u,meta:{currency:d,status:"pending",reason:"large_withdrawal_hold"}}),t.status(202).json({ok:!0,message:"Withdrawal request submitted and pending admin approval."});let{data:w,error:f}=await a.supabaseServer.from("wallets").select("id,amount").eq("user_id",o).eq("currency",d).maybeSingle();if(f)return t.status(500).json({error:"Wallet fetch failed"});if(!w||Number(w.amount)<Number(u))return t.status(400).json({error:"Insufficient balance"});let{error:h}=await a.supabaseServer.from("wallets").update({amount:Number(w.amount)-Number(u)}).eq("id",w.id);if(h)return t.status(500).json({error:"Failed to update wallet"});let{error:v}=await a.supabaseServer.from("transactions").insert({user_id:o,type:"withdraw",amount_usd:u,meta:{currency:d}});return v?t.status(500).json({error:"Failed to record withdrawal"}):t.status(200).json({ok:!0,message:`Withdrawal of ${u} ${d} recorded.`})}e.s(["default",()=>u]),r()}catch(e){r(e)}},!1),58034,e=>e.a(async(t,r)=>{try{var a=e.i(26747),s=e.i(90406),i=e.i(44898),n=e.i(62950),o=e.i(84459),u=e.i(7031),l=e.i(81927),d=e.i(46432),c=t([o]);[o]=c.then?(await c)():c;let m=(0,n.hoist)(o,"default"),w=(0,n.hoist)(o,"config"),f=new i.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/withdraw",pathname:"/api/withdraw",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,r){f.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/withdraw";s=s.replace(/\/index$/,"")||"/";let i=await f.prepare(e,t,{srcPage:s});if(!i){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:n,params:o,prerenderManifest:c,routerServerContext:p}=i;try{let r=e.method||"GET",a=(0,u.getTracer)(),i=a.getActiveScopeSpan(),d=f.instrumentationOnRequestError.bind(f),m=async i=>f.render(e,t,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:f.isDev,page:"/api/withdraw",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${r} ${n}`;i.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),i.updateName(e)}else i.updateName(`${r} ${s}`)});i?await m(i):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${r} ${s}`,kind:u.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(f.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,w,"default",0,m,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__1f1316af._.js.map