module.exports=[94131,(e,t,r)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var r=e.i(94131);let a=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||"",s=!!(a&&i),n=s?(0,r.createClient)(a,i):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,n,"supabaseServiceReady",0,s])},56798,e=>{"use strict";var t=e.i(30772);async function r(e){try{let r=String(e.headers.authorization||""),a=r.startsWith("Bearer ")?r.slice(7):"";if(!a)return{ok:!1,error:"Missing Authorization bearer token"};let{data:i,error:s}=await t.supabaseServer.auth.getUser(a);if(s||!i?.user?.id)return{ok:!1,error:"Invalid token"};let n=i.user.id,{data:o,error:u}=await t.supabaseServer.from("profiles").select("role,is_admin").eq("user_id",n).maybeSingle();if(u)return{ok:!1,error:"Profile lookup failed"};let l=String(o?.role||"").toLowerCase();if(!(o?.is_admin||"admin"===l))return{ok:!1,error:"Forbidden"};return{ok:!0,userId:n}}catch(e){return{ok:!1,error:e?.message||"Admin check failed"}}}e.s(["requireAdmin",()=>r])},97010,e=>e.a(async(t,r)=>{try{let t=await e.y("zod");e.n(t),r()}catch(e){r(e)}},!0),38765,e=>e.a(async(t,r)=>{try{var a=e.i(97010),i=e.i(30772),s=e.i(56798),n=t([a]);[a]=n.then?(await n)():n;let u=a.z.object({email:a.z.string().email()});async function o(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=await (0,s.requireAdmin)(e);if(!r.ok)return t.status(401).json({error:r.error||"Unauthorized"});let a=u.safeParse(e.body||{});if(!a.success)return t.status(400).json({error:"Invalid payload",issues:a.error.issues});let{email:n}=a.data;try{let{data:e,error:r}=await i.supabaseServer.auth.admin.inviteUserByEmail(n);if(r)return t.status(500).json({ok:!1,error:r.message||"Invite failed"});let a=e.user?.id;if(!a)return t.status(500).json({ok:!1,error:"Invite did not return a user ID"});let{data:s,error:o}=await i.supabaseServer.from("profiles").upsert({user_id:a,role:"admin",is_admin:!0},{onConflict:"user_id"}).select().maybeSingle();if(o)return t.status(500).json({ok:!1,error:"Failed to upsert profile",details:o.message});return t.status(200).json({ok:!0,invited:e.user,profile:s})}catch(e){return t.status(500).json({ok:!1,error:e?.message||"Invite-admin failed"})}}e.s(["default",()=>o]),r()}catch(e){r(e)}},!1),63256,e=>e.a(async(t,r)=>{try{var a=e.i(26747),i=e.i(90406),s=e.i(44898),n=e.i(62950),o=e.i(38765),u=e.i(7031),l=e.i(81927),d=e.i(46432),p=t([o]);[o]=p.then?(await p)():p;let m=(0,n.hoist)(o,"default"),f=(0,n.hoist)(o,"config"),v=new s.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/admin/users/invite-admin",pathname:"/api/admin/users/invite-admin",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function c(e,t,r){v.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/users/invite-admin";i=i.replace(/\/index$/,"")||"/";let s=await v.prepare(e,t,{srcPage:i});if(!s){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:n,params:o,prerenderManifest:p,routerServerContext:c}=s;try{let r=e.method||"GET",a=(0,u.getTracer)(),s=a.getActiveScopeSpan(),d=v.instrumentationOnRequestError.bind(v),m=async s=>v.render(e,t,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:v.isDev,page:"/api/admin/users/invite-admin",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${r} ${n}`;s.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),s.updateName(e)}else s.updateName(`${r} ${i}`)});s?await m(s):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${r} ${i}`,kind:u.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(v.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,f,"default",0,m,"handler",()=>c]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__a329536f._.js.map