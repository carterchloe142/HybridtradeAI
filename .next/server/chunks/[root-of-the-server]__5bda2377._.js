module.exports=[97010,e=>e.a(async(t,r)=>{try{let t=await e.y("zod");e.n(t),r()}catch(e){r(e)}},!0),94131,(e,t,r)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var r=e.i(94131);let a=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=!!(a&&s),i=n?(0,r.createClient)(a,s):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,i,"supabaseServiceReady",0,n])},55750,e=>{"use strict";let t=new Map;function r(e){return async function(r,a,s){let n=(r.headers["x-forwarded-for"]||"").split(",")[0].trim()||r.socket?.remoteAddress||"unknown",i=`${n}:${s}`,o=Date.now(),u=t.get(i);if(!u||o>u.resetAt)return t.set(i,{count:1,resetAt:o+e.windowMs}),a.setHeader("X-RateLimit-Remaining",String(e.max-1)),!0;if(u.count>=e.max){let e=u.resetAt-o;return a.setHeader("Retry-After",String(Math.ceil(e/1e3))),a.status(429).json({error:"Too many requests"}),!1}return u.count+=1,t.set(i,u),a.setHeader("X-RateLimit-Remaining",String(e.max-u.count)),!0}}e.s(["createRateLimiter",()=>r])},87759,e=>e.a(async(t,r)=>{try{var a=e.i(30772),s=e.i(55750),n=e.i(97010),i=t([n]);[n]=i.then?(await i)():i;let u=n.z.object({userId:n.z.string().min(1),amount:n.z.number().positive(),currency:n.z.enum(["USD","EUR","NGN","BTC","ETH"]),provider:n.z.string().min(1),planId:n.z.enum(["starter","pro","elite"])});async function o(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=(0,s.createRateLimiter)({windowMs:Number(process.env.RATE_LIMIT_WINDOW_MS??15e3),max:Number(process.env.RATE_LIMIT_MAX??20)});if(!await r(e,t,"deposit"))return;let n=u.safeParse(e.body||{});if(!n.success)return t.status(400).json({error:"Invalid payload",issues:n.error.issues});let{userId:i,amount:o,currency:d,provider:l,planId:p}=n.data,{error:c}=await a.supabaseServer.from("transactions").insert({user_id:i,type:"deposit",amount:o,currency:d,status:"pending",meta:{provider:l,planId:p}});if(c)return t.status(500).json({error:"Failed to record transaction",details:c.message});let{error:m}=await a.supabaseServer.from("investments").insert({user_id:i,plan_id:p,amount_usd:o,status:"active"});return m?t.status(500).json({error:"Failed to create investment"}):t.status(200).json({ok:!0,message:`Deposit of ${o} ${d} via ${l} recorded for plan ${p}.`})}e.s(["default",()=>o]),r()}catch(e){r(e)}},!1),24812,e=>e.a(async(t,r)=>{try{var a=e.i(26747),s=e.i(90406),n=e.i(44898),i=e.i(62950),o=e.i(87759),u=e.i(7031),d=e.i(81927),l=e.i(46432),p=t([o]);[o]=p.then?(await p)():p;let m=(0,i.hoist)(o,"default"),v=(0,i.hoist)(o,"config"),f=new n.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/deposit",pathname:"/api/deposit",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function c(e,t,r){f.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/deposit";s=s.replace(/\/index$/,"")||"/";let n=await f.prepare(e,t,{srcPage:s});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:o,prerenderManifest:p,routerServerContext:c}=n;try{let r=e.method||"GET",a=(0,u.getTracer)(),n=a.getActiveScopeSpan(),l=f.instrumentationOnRequestError.bind(f),m=async n=>f.render(e,t,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:f.isDev,page:"/api/deposit",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${r} ${i}`;n.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${s}`)});n?await m(n):await a.withPropagatedContext(e.headers,()=>a.trace(d.BaseServerSpan.handleRequest,{spanName:`${r} ${s}`,kind:u.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(f.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,v,"default",0,m,"handler",()=>c]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__5bda2377._.js.map