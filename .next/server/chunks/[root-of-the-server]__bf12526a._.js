module.exports=[59639,(e,t,r)=>{t.exports=e.x("node:process",()=>require("node:process"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},57764,(e,t,r)=>{t.exports=e.x("node:url",()=>require("node:url"))},4733,e=>e.a(async(t,r)=>{try{let t=await e.y("@prisma/client/runtime/library");e.n(t),r()}catch(e){r(e)}},!0),94131,(e,t,r)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},30772,e=>{"use strict";let t;var r=e.i(94131);let a=process.env.SUPABASE_URL||"https://wdlcttgfwoejqynlylpv.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=!!(a&&i),s=n?(0,r.createClient)(a,i):{auth:{getUser:t=async()=>{throw Error("supabase_service_not_configured")}},from:()=>({select:t,insert:t,update:t,delete:t,eq:()=>({select:t,insert:t,update:t,delete:t}),order:()=>({select:t}),range:()=>({select:t}),maybeSingle:t})};e.s(["supabaseServer",0,s,"supabaseServiceReady",0,n])},56798,e=>{"use strict";var t=e.i(30772);async function r(e){try{let r=String(e.headers.authorization||""),a=r.startsWith("Bearer ")?r.slice(7):"";if(!a)return{ok:!1,error:"Missing Authorization bearer token"};let{data:i,error:n}=await t.supabaseServer.auth.getUser(a);if(n||!i?.user?.id)return{ok:!1,error:"Invalid token"};let s=i.user.id,{data:o,error:d}=await t.supabaseServer.from("profiles").select("role,is_admin").eq("user_id",s).maybeSingle();if(d)return{ok:!1,error:"Profile lookup failed"};let u=String(o?.role||"").toLowerCase();if(!(o?.is_admin||"admin"===u))return{ok:!1,error:"Forbidden"};return{ok:!0,userId:s}}catch(e){return{ok:!1,error:e?.message||"Admin check failed"}}}e.s(["requireAdmin",()=>r])},55750,e=>{"use strict";let t=new Map;function r(e){return async function(r,a,i){let n=(r.headers["x-forwarded-for"]||"").split(",")[0].trim()||r.socket?.remoteAddress||"unknown",s=`${n}:${i}`,o=Date.now(),d=t.get(s);if(!d||o>d.resetAt)return t.set(s,{count:1,resetAt:o+e.windowMs}),a.setHeader("X-RateLimit-Remaining",String(e.max-1)),!0;if(d.count>=e.max){let e=d.resetAt-o;return a.setHeader("Retry-After",String(Math.ceil(e/1e3))),a.status(429).json({error:"Too many requests"}),!1}return d.count+=1,t.set(s,d),a.setHeader("X-RateLimit-Remaining",String(e.max-d.count)),!0}}e.s(["createRateLimiter",()=>r])},6483,e=>e.a(async(t,r)=>{try{var a=e.i(82911),i=e.i(55750),n=e.i(56798),s=e.i(30772),o=t([a]);[a]=o.then?(await o)():o;let u=(0,i.createRateLimiter)({windowMs:6e4,max:5});async function d(e,t){if("POST"!==e.method)return t.status(405).json({error:"method_not_allowed"});if(!await u(e,t,"admin-approve-credit"))return;let r=await (0,n.requireAdmin)(e);if(!r.ok||!r.userId)return t.status(403).json({error:r.error||"forbidden"});let i=r.userId,{actionId:o}=e.body??{};if(!o)return t.status(400).json({error:"missing_action_id"});try{let e=await a.default.adminAction.findUnique({where:{id:o}});if(!e)throw Error("action_not_found");if("PENDING"!==e.status)throw Error("action_not_pending");let r=e.userId,{data:n}=await s.supabaseServer.from("wallets").select("id,amount").eq("user_id",r).eq("currency","USD").maybeSingle(),d=n?.id,u=Number(n?.amount??0);if(!d){let{data:e,error:t}=await s.supabaseServer.from("wallets").insert({user_id:r,currency:"USD",amount:0}).select().maybeSingle();if(t)throw Error("wallet_create_failed");d=e?.id,u=0}let l=Number(e.amount),c=Number((u+l).toFixed(8)),{error:p}=await s.supabaseServer.from("wallets").update({amount:c}).eq("id",d);if(p)throw Error("wallet_update_failed");let m=await a.default.walletTransaction.create({data:{walletId:d,amount:l.toString(),type:"CREDIT",source:"admin_credit_approval",reference:e.id,note:e.note||null,performedBy:i}}),f=await a.default.adminAction.update({where:{id:e.id},data:{status:"COMPLETED",approvedBy:i,approvedAt:new Date}});return t.json({balance:c,transaction:m,action:f})}catch(e){return t.status(500).json({error:e?.message||"approve_failed"})}}e.s(["config",0,{api:{bodyParser:!0}},"default",()=>d]),r()}catch(e){r(e)}},!1),18038,e=>e.a(async(t,r)=>{try{var a=e.i(26747),i=e.i(90406),n=e.i(44898),s=e.i(62950),o=e.i(6483),d=e.i(7031),u=e.i(81927),l=e.i(46432),c=t([o]);[o]=c.then?(await c)():c;let m=(0,s.hoist)(o,"default"),f=(0,s.hoist)(o,"config"),w=new n.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/admin/approve-credit",pathname:"/api/admin/approve-credit",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,r){w.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/approve-credit";i=i.replace(/\/index$/,"")||"/";let n=await w.prepare(e,t,{srcPage:i});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:s,params:o,prerenderManifest:c,routerServerContext:p}=n;try{let r=e.method||"GET",a=(0,d.getTracer)(),n=a.getActiveScopeSpan(),l=w.instrumentationOnRequestError.bind(w),m=async n=>w.render(e,t,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:w.isDev,page:"/api/admin/approve-credit",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${r} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${i}`)});n?await m(n):await a.withPropagatedContext(e.headers,()=>a.trace(u.BaseServerSpan.handleRequest,{spanName:`${r} ${i}`,kind:d.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(w.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,f,"default",0,m,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__bf12526a._.js.map