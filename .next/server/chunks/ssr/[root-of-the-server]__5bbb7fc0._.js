module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},75050,a=>{"use strict";var b=a.i(8171),c=a.i(27669),d=a.i(76165);function e({children:a}){let[e,f]=(0,c.useState)("loading");return((0,c.useEffect)(()=>{let a=!0;return async function(){let{data:b}=await d.supabase.auth.getSession(),c=b.session?.user;if(!c){a&&f("noauth");return}let{data:e}=await d.supabase.from("profiles").select("role,is_admin").eq("user_id",c.id).maybeSingle(),g=!!e?.is_admin||"admin"===String(e?.role||"").toLowerCase();a&&f(g?"ok":"forbidden")}(),()=>{a=!1}},[]),"loading"===e)?(0,b.jsx)("div",{className:"p-6",children:"Checking permissions…"}):"noauth"===e?(0,b.jsx)("div",{className:"p-6",children:"Sign in required."}):"forbidden"===e?(0,b.jsx)("div",{className:"p-6",children:"Not authorized."}):(0,b.jsx)(b.Fragment,{children:a})}a.s(["default",()=>e])},56083,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(67298),g=a.i(8171),h=a.i(27669),i=a.i(75050),j=a.i(76165);function k(){let[a,b]=(0,h.useState)(""),[c,d]=(0,h.useState)(""),[e,f]=(0,h.useState)(""),[k,l]=(0,h.useState)(!1),[m,n]=(0,h.useState)(null),[o,p]=(0,h.useState)(null),[q,r]=(0,h.useState)([]),[s,t]=(0,h.useState)(1),[u,v]=(0,h.useState)(25),[w,x]=(0,h.useState)(0),[y,z]=(0,h.useState)(null),[A,B]=(0,h.useState)("");async function C(a=s,b=u){try{let{data:c}=await j.supabase.auth.getSession(),d=c.session?.access_token,e=await fetch(`/api/admin/credit-user?page=${a}&limit=${b}`,{headers:d?{Authorization:`Bearer ${d}`}:void 0}),f=await e.json();e.ok?(r(f.actions??[]),x(Number(f.total||0)),t(Number(f.page||a)),v(Number(f.limit||b))):(n(f.error||"Failed to load admin credits"),r([]))}catch(a){n(a?.message||"Failed to load admin credits")}}async function D(){try{let{data:a}=await j.supabase.auth.getSession(),b=a.session?.access_token,c=await fetch("/api/admin/health",{headers:b?{Authorization:`Bearer ${b}`}:void 0}),d=await c.json();c.ok?z(d.status||null):B(d.error||"Health check failed")}catch(a){B(a?.message||"Health check failed")}}async function E(){n(null),p(null),l(!0);try{let g=Number(c);if(!a||!g||g<=0)return void n("Enter a valid user identifier (email or UUID) and amount > 0");let{data:h}=await j.supabase.auth.getSession(),i=h.session?.access_token,k=await fetch("/api/admin/credit-user",{method:"POST",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify({...a.includes("@")?{email:a}:{userId:a},amount:g,description:e})}),l=await k.json();if(k.ok)"pending"===l.status?n("Credit logged as pending approval"):(n(`Credited. New balance: ${l.balance}`),b(""),d(""),f(""));else{let a=String(l.error||"");p(a||null),n("manual_credits_disabled"===a?"Manual credits are disabled by configuration.":"service_role_not_configured"===a?"Supabase service role is not configured.":"invalid_user_identifier"===a?"User not found. Check email or UUID.":a.startsWith("wallet_select_failed")?"Could not read wallet; check Supabase permissions.":a.startsWith("wallet_create_failed")?"Could not create wallet; check Supabase schema.":a.startsWith("wallet_update_failed")?"Could not update wallet; check Supabase RLS.":a.startsWith("transactions_insert_failed")?"Could not insert transaction; check Supabase schema.":l.error||"Credit failed")}C()}catch(a){n(a?.message||"Request failed")}finally{l(!1)}}return(0,h.useEffect)(()=>{C(s,u),D()},[s,u]),(0,g.jsx)(i.default,{children:(0,g.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,g.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Manual Credit"}),y&&(0,g.jsxs)("div",{className:"mb-4 text-sm",children:[(0,g.jsxs)("p",{children:["Manual Credits Enabled: ",String(y.manualCreditsEnabled??!1)]}),(0,g.jsxs)("p",{children:["Service Role Configured: ",String(y.serviceRoleConfigured??!1)]}),(0,g.jsxs)("p",{children:["Prisma Ready: ",String(y.prismaReady??!1)]}),(0,g.jsxs)("p",{children:["Wallets Table Ready: ",String(y.walletsTableReady??!1)]}),!y.prismaReady&&y.prismaError&&!0!==y.prismaOptional&&(0,g.jsxs)("div",{className:"mt-2 rounded px-3 py-2 bg-red-100 text-red-700",children:["Prisma error: ",y.prismaError]}),(0,g.jsxs)("div",{className:`mt-2 rounded px-3 py-2 ${y.manualCreditsEnabled&&y.serviceRoleConfigured?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[!y.manualCreditsEnabled&&(0,g.jsx)("span",{children:"Manual credits are disabled. Enable in environment config."}),y.manualCreditsEnabled&&!y.serviceRoleConfigured&&(0,g.jsx)("span",{children:"Supabase service role is not configured. Set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY."}),y.manualCreditsEnabled&&y.serviceRoleConfigured&&(0,g.jsx)("span",{children:"Manual credit is ready."})]})]}),A&&(0,g.jsx)("p",{className:"text-sm text-red-600 mb-2",children:A}),(0,g.jsxs)("div",{className:"bg-white shadow rounded p-4 space-y-3",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium",children:"User Identifier"}),(0,g.jsx)("input",{value:a,onChange:a=>b(a.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"Enter user email or Supabase UUID"}),(0,g.jsx)("p",{className:"mt-1 text-xs text-gray-600",children:"You can paste the user's email, Supabase user UUID, or a Prisma cuid; emails are recommended."})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium",children:"Amount"}),(0,g.jsx)("input",{value:c,onChange:a=>d(a.target.value),className:"mt-1 w-full border rounded px-3 py-2",type:"number",step:"0.01",placeholder:"e.g., 100"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium",children:"Description (optional)"}),(0,g.jsx)("input",{value:e,onChange:a=>f(a.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"Reason"})]}),(0,g.jsx)("button",{disabled:k||!!(y&&(!y.manualCreditsEnabled||!y.serviceRoleConfigured)),onClick:E,className:"bg-blue-600 text-white rounded px-4 py-2 disabled:opacity-50",children:k?"Processing...":"Credit User"}),m&&(0,g.jsxs)("div",{className:`mt-2 text-sm ${o?"text-red-600":"text-green-700"}`,children:[m,o&&(0,g.jsxs)("span",{className:"ml-2",children:["(",o,")"]})]})]}),(0,g.jsx)("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"Recent Admin Credits"}),(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)("table",{className:"min-w-full text-sm",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{className:"text-left",children:[(0,g.jsx)("th",{className:"px-3 py-2",children:"Date"}),(0,g.jsx)("th",{className:"px-3 py-2",children:"Admin"}),(0,g.jsx)("th",{className:"px-3 py-2",children:"User"}),(0,g.jsx)("th",{className:"px-3 py-2",children:"Amount"}),(0,g.jsx)("th",{className:"px-3 py-2",children:"Status"}),(0,g.jsx)("th",{className:"px-3 py-2",children:"Note"})]})}),(0,g.jsx)("tbody",{children:q.map(a=>(0,g.jsxs)("tr",{className:"border-t",children:[(0,g.jsx)("td",{className:"px-3 py-2",children:new Date(a.createdAt).toLocaleString()}),(0,g.jsx)("td",{className:"px-3 py-2",children:a.adminId}),(0,g.jsx)("td",{className:"px-3 py-2",children:a.userId}),(0,g.jsx)("td",{className:"px-3 py-2",children:a.amount}),(0,g.jsx)("td",{className:"px-3 py-2",children:a.status}),(0,g.jsx)("td",{className:"px-3 py-2",children:a.note??""})]},a.id))})]})}),(0,g.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("button",{className:"bg-gray-200 text-black rounded px-3 py-1 disabled:opacity-50",disabled:s<=1,onClick:()=>t(a=>Math.max(1,a-1)),children:"Prev"}),(0,g.jsx)("button",{className:"bg-gray-200 text-black rounded px-3 py-1 disabled:opacity-50",disabled:s*u>=w,onClick:()=>t(a=>a+1),children:"Next"})]}),(0,g.jsxs)("div",{className:"text-sm",children:["Page ",s," • Showing ",q.length," of ",w,(0,g.jsx)("select",{className:"border rounded px-2 py-1 ml-3",value:u,onChange:a=>v(Number(a.target.value)),children:[10,25,50,100].map(a=>(0,g.jsxs)("option",{value:a,children:[a,"/page"]},a))})]})]})]})})}a.s(["default",()=>k],49563);var l=a.i(49563),m=a.i(9193);let n=(0,d.hoist)(l,"default"),o=(0,d.hoist)(l,"getStaticProps"),p=(0,d.hoist)(l,"getStaticPaths"),q=(0,d.hoist)(l,"getServerSideProps"),r=(0,d.hoist)(l,"config"),s=(0,d.hoist)(l,"reportWebVitals"),t=(0,d.hoist)(l,"unstable_getStaticProps"),u=(0,d.hoist)(l,"unstable_getStaticPaths"),v=(0,d.hoist)(l,"unstable_getStaticParams"),w=(0,d.hoist)(l,"unstable_getServerProps"),x=(0,d.hoist)(l,"unstable_getServerSideProps"),y=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/manual-credit",pathname:"/admin/manual-credit",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:l}),z=(0,m.getHandler)({srcPage:"/admin/manual-credit",config:r,userland:l,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});a.s(["config",0,r,"default",0,n,"getServerSideProps",0,q,"getStaticPaths",0,p,"getStaticProps",0,o,"handler",0,z,"reportWebVitals",0,s,"routeModule",0,y,"unstable_getServerProps",0,w,"unstable_getServerSideProps",0,x,"unstable_getStaticParams",0,v,"unstable_getStaticPaths",0,u,"unstable_getStaticProps",0,t],56083)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5bbb7fc0._.js.map