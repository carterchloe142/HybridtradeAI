module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},75050,a=>{"use strict";var b=a.i(8171),c=a.i(27669),d=a.i(76165);function e({children:a}){let[e,f]=(0,c.useState)("loading");return((0,c.useEffect)(()=>{let a=!0;return async function(){let{data:b}=await d.supabase.auth.getSession(),c=b.session?.user;if(!c){a&&f("noauth");return}let{data:e}=await d.supabase.from("profiles").select("role,is_admin").eq("user_id",c.id).maybeSingle(),g=!!e?.is_admin||"admin"===String(e?.role||"").toLowerCase();a&&f(g?"ok":"forbidden")}(),()=>{a=!1}},[]),"loading"===e)?(0,b.jsx)("div",{className:"p-6",children:"Checking permissions…"}):"noauth"===e?(0,b.jsx)("div",{className:"p-6",children:"Sign in required."}):"forbidden"===e?(0,b.jsx)("div",{className:"p-6",children:"Not authorized."}):(0,b.jsx)(b.Fragment,{children:a})}a.s(["default",()=>e])},12871,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(67298),g=a.i(8171),h=a.i(27669),i=a.i(75050),j=a.i(76165);function k(){let[a,b]=(0,h.useState)([]),[c,d]=(0,h.useState)(!0),[e,f]=(0,h.useState)(""),[k,l]=(0,h.useState)(null),[m,n]=(0,h.useState)(null),[o,p]=(0,h.useState)(null),[q,r]=(0,h.useState)(""),[s,t]=(0,h.useState)({}),[u,v]=(0,h.useState)("all"),[w,x]=(0,h.useState)("");async function y(){d(!0);try{let{data:a}=await j.supabase.auth.getSession(),c=a.session?.access_token;if(!c)throw Error("Session lost");let d=await fetch("/api/admin/kyc",{headers:{Authorization:`Bearer ${c}`}}),e=await d.json();if(!d.ok)throw Error(e.error||"Failed to load");b(e.items||[])}catch(a){f(a.message)}finally{d(!1)}}async function z(a){l(a),n(null),p(null),r("");try{let{data:b}=await j.supabase.auth.getSession(),c=b.session?.access_token;if(!c)throw Error("Session lost");let d=await fetch(`/api/admin/kyc?userId=${encodeURIComponent(a)}&files=1`,{headers:{Authorization:`Bearer ${c}`}}),e=await d.json();if(!d.ok)throw Error(e.error||"Failed");p(e.files||null),n(e.details||null)}catch(a){f(a.message)}}async function A(a,b,c){let{data:d}=await j.supabase.auth.getSession(),e=d.session?.access_token;if(!e)return f("Session lost");try{let d=await fetch("/api/admin/kyc",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({userId:a,status:b,level:c,reason:"rejected"===b?q:void 0})}),g=await d.json();if(!d.ok)throw Error(g.error||"Failed");f(`KYC ${b}`),y()}catch(a){f(a.message)}}return(0,h.useEffect)(()=>{y()},[]),(0,g.jsx)(i.default,{children:(0,g.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,g.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"KYC Review"}),e&&(0,g.jsx)("p",{className:"mb-2 text-sm text-blue-600",children:e}),(0,g.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[(0,g.jsx)("button",{onClick:()=>y(),className:"text-xs bg-gray-700 text-white px-2 py-1 rounded",children:"Refresh"}),(0,g.jsxs)("select",{value:u,onChange:a=>v(a.target.value),className:"text-xs border rounded px-2 py-1",children:[(0,g.jsx)("option",{value:"all",children:"All"}),(0,g.jsx)("option",{value:"pending",children:"Pending"}),(0,g.jsx)("option",{value:"approved",children:"Approved"}),(0,g.jsx)("option",{value:"rejected",children:"Rejected"})]}),(0,g.jsx)("input",{value:w,onChange:a=>x(a.target.value),placeholder:"Search email",className:"text-xs border rounded px-2 py-1"}),(0,g.jsx)("button",{onClick:async()=>{try{let{data:a}=await j.supabase.auth.getSession(),b=a.session?.access_token;if(!b)throw Error("Session lost");let c=await fetch("/api/admin/storage/kyc-init",{headers:{Authorization:`Bearer ${b}`}}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed");f("KYC storage ready")}catch(a){f(a.message)}},className:"text-xs bg-blue-700 text-white px-2 py-1 rounded",children:"Init Storage"})]}),c&&(0,g.jsx)("p",{className:"text-sm",children:"Loading…"}),(0,g.jsx)("div",{className:"overflow-auto",children:(0,g.jsxs)("table",{className:"min-w-full table-auto text-sm",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{className:"bg-gray-100 text-black",children:[(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Email"}),(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Level"}),(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Status"}),(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Submitted"}),(0,g.jsx)("th",{className:"px-2 py-1",children:"Actions"})]})}),(0,g.jsx)("tbody",{children:a.filter(a=>"all"===u||String(a.kyc_status||"pending")===u).filter(a=>!w||String(a.email||"").toLowerCase().includes(w.toLowerCase())).map(a=>(0,g.jsxs)("tr",{className:"border-t",children:[(0,g.jsx)("td",{className:"px-2 py-1",children:a.email}),(0,g.jsx)("td",{className:"px-2 py-1",children:a.kyc_level??"-"}),(0,g.jsx)("td",{className:"px-2 py-1",children:(0,g.jsx)("span",{className:`inline-block px-2 rounded text-xs ${"approved"===a.kyc_status?"bg-green-100 text-green-800":"rejected"===a.kyc_status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a.kyc_status})}),(0,g.jsx)("td",{className:"px-2 py-1",children:a.kyc_submitted_at?new Date(a.kyc_submitted_at).toLocaleString():"-"}),(0,g.jsx)("td",{className:"px-2 py-1",children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)("button",{onClick:()=>z(a.user_id),className:"text-xs bg-gray-600 text-white px-2 py-1 rounded",children:"View Details"}),"pending"===a.kyc_status&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("select",{value:s[a.user_id]??a.kyc_level??1,onChange:b=>t(c=>({...c,[a.user_id]:Number(b.target.value)})),className:"text-xs border rounded px-2 py-1",children:[1,2,3].map(a=>(0,g.jsxs)("option",{value:a,children:["Level ",a]},a))}),(0,g.jsx)("button",{onClick:()=>A(a.user_id,"approved",s[a.user_id]??a.kyc_level??1),className:"text-xs bg-green-600 text-white px-2 py-1 rounded",children:"Approve"}),(0,g.jsx)("input",{value:k===a.user_id?q:"",onChange:b=>{k===a.user_id&&r(b.target.value)},placeholder:"Reason",className:"text-xs border rounded px-2 py-1",style:{width:120}}),(0,g.jsx)("button",{onClick:()=>A(a.user_id,"rejected"),className:"text-xs bg-red-600 text-white px-2 py-1 rounded",children:"Reject"})]})]})})]},a.user_id))})]})}),k&&(0,g.jsxs)("div",{className:"mt-4 p-4 border rounded bg-white",children:[(0,g.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"KYC Details"}),m&&(0,g.jsxs)("div",{className:"text-sm space-y-1",children:[(0,g.jsxs)("p",{children:["Full Name: ",String(m?.fullName||"")]}),(0,g.jsxs)("p",{children:["Date of Birth: ",String(m?.dob||"")]}),(0,g.jsxs)("p",{children:["Address: ",String(m?.address||"")]}),(0,g.jsxs)("p",{children:["ID Type: ",String(m?.idType||"")]}),(0,g.jsxs)("p",{children:["ID Number: ",String(m?.idNumber||"")]}),(0,g.jsxs)("p",{children:["Level: ",String(m?.level||"")]})]}),(0,g.jsxs)("div",{className:"flex flex-wrap gap-3 mt-3 text-sm",children:[o?.idUrl&&(0,g.jsx)("a",{href:o.idUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View ID"}),o?.neutralUrl&&(0,g.jsx)("a",{href:o.neutralUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"Neutral"}),o?.smileUrl&&(0,g.jsx)("a",{href:o.smileUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"Smile"}),o?.leftUrl&&(0,g.jsx)("a",{href:o.leftUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"Left"}),o?.rightUrl&&(0,g.jsx)("a",{href:o.rightUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"Right"})]}),m?.livenessMetrics&&(0,g.jsxs)("div",{className:"mt-2 text-xs",children:[(0,g.jsxs)("p",{children:["Smile vs Neutral diff: ",String(m.livenessMetrics.diff_smile_vs_neutral),"%"]}),(0,g.jsxs)("p",{children:["Left vs Neutral diff: ",String(m.livenessMetrics.diff_left_vs_neutral),"%"]}),(0,g.jsxs)("p",{children:["Right vs Neutral diff: ",String(m.livenessMetrics.diff_right_vs_neutral),"%"]})]}),(0,g.jsxs)("div",{className:"mt-3 text-sm",children:[a.find(a=>a.user_id===k)?.kyc_reject_reason&&(0,g.jsxs)("p",{className:"text-red-700",children:["Reject Reason: ",String(a.find(a=>a.user_id===k)?.kyc_reject_reason||"")]}),a.find(a=>a.user_id===k)?.kyc_decision_at&&(0,g.jsxs)("p",{children:["Decision At: ",new Date(String(a.find(a=>a.user_id===k)?.kyc_decision_at)).toLocaleString()]})]})]})]})})}a.s(["default",()=>k],45425);var l=a.i(45425),m=a.i(9193);let n=(0,d.hoist)(l,"default"),o=(0,d.hoist)(l,"getStaticProps"),p=(0,d.hoist)(l,"getStaticPaths"),q=(0,d.hoist)(l,"getServerSideProps"),r=(0,d.hoist)(l,"config"),s=(0,d.hoist)(l,"reportWebVitals"),t=(0,d.hoist)(l,"unstable_getStaticProps"),u=(0,d.hoist)(l,"unstable_getStaticPaths"),v=(0,d.hoist)(l,"unstable_getStaticParams"),w=(0,d.hoist)(l,"unstable_getServerProps"),x=(0,d.hoist)(l,"unstable_getServerSideProps"),y=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/kyc",pathname:"/admin/kyc",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:l}),z=(0,m.getHandler)({srcPage:"/admin/kyc",config:r,userland:l,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});a.s(["config",0,r,"default",0,n,"getServerSideProps",0,q,"getStaticPaths",0,p,"getStaticProps",0,o,"handler",0,z,"reportWebVitals",0,s,"routeModule",0,y,"unstable_getServerProps",0,w,"unstable_getServerSideProps",0,x,"unstable_getStaticParams",0,v,"unstable_getStaticPaths",0,u,"unstable_getStaticProps",0,t],12871)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7ea04202._.js.map