module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},75050,a=>{"use strict";var b=a.i(8171),c=a.i(27669),d=a.i(76165);function e({children:a}){let[e,f]=(0,c.useState)("loading");return((0,c.useEffect)(()=>{let a=!0;return async function(){let{data:b}=await d.supabase.auth.getSession(),c=b.session?.user;if(!c){a&&f("noauth");return}let{data:e}=await d.supabase.from("profiles").select("role,is_admin").eq("user_id",c.id).maybeSingle(),g=!!e?.is_admin||"admin"===String(e?.role||"").toLowerCase();a&&f(g?"ok":"forbidden")}(),()=>{a=!1}},[]),"loading"===e)?(0,b.jsx)("div",{className:"p-6",children:"Checking permissions…"}):"noauth"===e?(0,b.jsx)("div",{className:"p-6",children:"Sign in required."}):"forbidden"===e?(0,b.jsx)("div",{className:"p-6",children:"Not authorized."}):(0,b.jsx)(b.Fragment,{children:a})}a.s(["default",()=>e])},15069,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(67298),g=a.i(8171),h=a.i(27669),i=a.i(75050),j=a.i(76165);function k(){let[a,b]=(0,h.useState)([]),[c,d]=(0,h.useState)(!0),[e,f]=(0,h.useState)(""),[k,l]=(0,h.useState)(null),[m,n]=(0,h.useState)("");async function o(){d(!0);let{data:a,error:c}=await j.supabase.from("support_tickets").select(`
        id,user_id,subject,status,created_at,
        profiles(email),
        replies(id,body,is_admin,created_at)
      `).order("created_at",{ascending:!1});c?console.error(c):b(a||[]),d(!1)}async function p(){if(!k||!m.trim())return;let{data:a}=await j.supabase.auth.getSession(),b=a.session?.access_token;if(!b)return f("Session lost");try{let a=await fetch("/api/admin/support",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({ticketId:k,body:m})}),c=await a.json();if(!a.ok)throw Error(c.error||"Failed");n(""),f("Reply sent"),o()}catch(a){f(a.message)}}async function q(a){let{data:b}=await j.supabase.auth.getSession(),c=b.session?.access_token;if(!c)return f("Session lost");try{let b=await fetch("/api/admin/support",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({ticketId:a,status:"closed"})}),d=await b.json();if(!b.ok)throw Error(d.error||"Failed");f("Ticket closed"),o()}catch(a){f(a.message)}}(0,h.useEffect)(()=>{o()},[]);let r=a.find(a=>a.id===k);return(0,g.jsx)(i.default,{children:(0,g.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,g.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Support Tickets"}),e&&(0,g.jsx)("p",{className:"mb-2 text-sm text-blue-600",children:e}),c&&(0,g.jsx)("p",{className:"text-sm",children:"Loading…"}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsx)("div",{className:"md:col-span-1",children:(0,g.jsx)("div",{className:"overflow-auto max-h-96",children:(0,g.jsxs)("table",{className:"min-w-full table-auto text-sm",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{className:"bg-gray-100 text-black",children:[(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Subject"}),(0,g.jsx)("th",{className:"px-2 py-1 text-left",children:"Status"})]})}),(0,g.jsx)("tbody",{children:a.map(a=>(0,g.jsxs)("tr",{className:`border-t cursor-pointer ${k===a.id?"bg-blue-50":""}`,onClick:()=>l(a.id),children:[(0,g.jsx)("td",{className:"px-2 py-1",children:a.subject}),(0,g.jsx)("td",{className:"px-2 py-1",children:(0,g.jsx)("span",{className:`inline-block px-2 rounded text-xs ${"open"===a.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status})})]},a.id))})]})})}),(0,g.jsx)("div",{className:"md:col-span-2",children:r?(0,g.jsxs)("div",{className:"border rounded p-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,g.jsx)("h2",{className:"font-medium",children:r.subject}),"open"===r.status&&(0,g.jsx)("button",{onClick:()=>q(r.id),className:"text-xs bg-red-600 text-white px-2 py-1 rounded",children:"Close"})]}),(0,g.jsx)("div",{className:"space-y-2 max-h-64 overflow-auto",children:r.replies.map(a=>(0,g.jsxs)("div",{className:`p-2 rounded text-sm ${a.is_admin?"bg-blue-50":"bg-gray-50"}`,children:[(0,g.jsx)("div",{className:"font-medium text-xs",children:a.is_admin?"Admin":r.profiles?.email}),(0,g.jsx)("div",{children:a.body}),(0,g.jsx)("div",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleString()})]},a.id))}),"open"===r.status&&(0,g.jsxs)("div",{className:"mt-3",children:[(0,g.jsx)("textarea",{className:"w-full border rounded p-2 text-sm",rows:3,value:m,onChange:a=>n(a.target.value),placeholder:"Your reply…"}),(0,g.jsx)("button",{onClick:p,className:"mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"Send"})]})]}):(0,g.jsx)("p",{className:"text-gray-500 text-sm",children:"Select a ticket to view details"})})]})]})})}a.s(["default",()=>k],16351);var l=a.i(16351),m=a.i(9193);let n=(0,d.hoist)(l,"default"),o=(0,d.hoist)(l,"getStaticProps"),p=(0,d.hoist)(l,"getStaticPaths"),q=(0,d.hoist)(l,"getServerSideProps"),r=(0,d.hoist)(l,"config"),s=(0,d.hoist)(l,"reportWebVitals"),t=(0,d.hoist)(l,"unstable_getStaticProps"),u=(0,d.hoist)(l,"unstable_getStaticPaths"),v=(0,d.hoist)(l,"unstable_getStaticParams"),w=(0,d.hoist)(l,"unstable_getServerProps"),x=(0,d.hoist)(l,"unstable_getServerSideProps"),y=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/support",pathname:"/admin/support",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:l}),z=(0,m.getHandler)({srcPage:"/admin/support",config:r,userland:l,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});a.s(["config",0,r,"default",0,n,"getServerSideProps",0,q,"getStaticPaths",0,p,"getStaticProps",0,o,"handler",0,z,"reportWebVitals",0,s,"routeModule",0,y,"unstable_getServerProps",0,w,"unstable_getServerSideProps",0,x,"unstable_getStaticParams",0,v,"unstable_getStaticPaths",0,u,"unstable_getStaticProps",0,t],15069)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ac4f00c2._.js.map