module.exports=[36139,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(67298),g=a.i(8171),h=a.i(27669),i=a.i(98527),j=a.i(76165),k=a.i(64375);let l=(0,k.default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var m=a.i(66167);let n=(0,k.default)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),o=(0,k.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);function p(){let[a,b]=(0,h.useState)(null),[c,d]=(0,h.useState)(1),[e,f]=(0,h.useState)(""),[k,p]=(0,h.useState)(""),[q,r]=(0,h.useState)(""),[s,t]=(0,h.useState)("national_id"),[u,v]=(0,h.useState)(""),[w,x]=(0,h.useState)("NG"),[y,z]=(0,h.useState)(""),[A,B]=(0,h.useState)(null),[C,D]=(0,h.useState)(null),[E,F]=(0,h.useState)(null),[G,H]=(0,h.useState)(null),[I,J]=(0,h.useState)(null),[K,L]=(0,h.useState)(1),[M,N]=(0,h.useState)(!1),[O,P]=(0,h.useState)(null),[Q,R]=(0,h.useState)(null),[S,T]=(0,h.useState)(!1),[U,V]=(0,h.useState)(""),W={NG:{name:"Nigeria",idTypes:[{value:"national_id",label:"National ID (NIN)",pattern:/^[0-9]{11}$/},{value:"passport",label:"Passport",pattern:/^[A-Z0-9]{8,9}$/},{value:"driver_license",label:"Driver License",pattern:/^[A-Z0-9\-]{10,}$/},{value:"voter_card",label:"Voter Card",pattern:/^[A-Z0-9]{10,}$/}]},US:{name:"United States",idTypes:[{value:"passport",label:"Passport",pattern:/^[A-Z0-9]{9}$/},{value:"driver_license",label:"Driver License",pattern:/^[A-Z0-9\-]{5,}$/},{value:"national_id",label:"SSN (last 4)",pattern:/^[0-9]{4}$/}]},GB:{name:"United Kingdom",idTypes:[{value:"passport",label:"Passport",pattern:/^[0-9]{9}$/},{value:"driver_license",label:"Driver License",pattern:/^[A-Z0-9]{16}$/}]}};async function X(){try{let{data:a}=await j.supabase.auth.getUser(),c=a.user?.id;if(!c)return;let{data:e}=await j.supabase.from("profiles").select("user_id,email,kyc_status,kyc_level,kyc_submitted_at").eq("user_id",c).maybeSingle();b(e||null),"number"==typeof e?.kyc_level&&d(Number(e.kyc_level))}catch{}}function Y(a){if(!Q)return null;let b=document.createElement("canvas");return b.width=Q.videoWidth||640,b.height=Q.videoHeight||480,b.getContext("2d").drawImage(Q,0,0,b.width,b.height),new Promise(c=>{b.toBlob(b=>{c(b?new File([b],a,{type:"image/jpeg"}):null)},"image/jpeg",.9)})}function Z(a){return new Promise((b,c)=>{let d=new Image;d.onload=()=>{let a=document.createElement("canvas");a.width=d.naturalWidth,a.height=d.naturalHeight;let c=a.getContext("2d");c.drawImage(d,0,0),b(c.getImageData(0,0,a.width,a.height))},d.onerror=a=>c(a),d.src=URL.createObjectURL(a)})}function $(a,b){let c=Math.min(a.width,b.width),d=Math.min(a.height,b.height),e=0;for(let f=0;f<d;f++)for(let d=0;d<c;d++){let g=(f*c+d)*4;(Math.abs(a.data[g]-b.data[g])+Math.abs(a.data[g+1]-b.data[g+1])+Math.abs(a.data[g+2]-b.data[g+2]))/3>25&&e++}return Math.round(e/(c*d)*1e3)/10}async function _(){T(!0),V("");try{let{data:a}=await j.supabase.auth.getSession(),b=a.session?.access_token;if(!b)throw Error("Session expired");let{data:d}=await j.supabase.auth.getUser();if(!d.user?.id)throw Error("Not authenticated");let g=W[w]?.idTypes.find(a=>a.value===s),h=g?.pattern;if(!e||!k||!q||!s||!u||!A)throw Error("Fill all fields and attach files");if(h&&!h.test(u))throw Error("ID number format invalid for selected country/type");if(!C||!E||!G||!I)throw Error("Capture all selfie steps (neutral, smile, left, right)");if(A.size>6e6)throw Error("ID file too large");if(!["image/jpeg","image/png","application/pdf"].includes(A.type))throw Error("Invalid ID file type");for(let a of[C,E,G,I]){if(a.size>6e6)throw Error("Selfie too large");if(!["image/jpeg","image/png"].includes(a.type))throw Error("Invalid selfie file type")}let i=await Z(C),l=await Z(E),m=await Z(G),n=await Z(I),o={diff_smile_vs_neutral:$(i,l),diff_left_vs_neutral:$(i,m),diff_right_vs_neutral:$(i,n)},x=a=>new Promise((b,c)=>{let d=new FileReader;d.onload=()=>b(String(d.result||"")),d.onerror=a=>c(a),d.readAsDataURL(a)}),z={idFileDataUrl:await x(A),selfieNeutralDataUrl:await x(C),selfieSmileDataUrl:await x(E),selfieLeftDataUrl:await x(G),selfieRightDataUrl:await x(I),payload:{fullName:e,dob:k,address:q,country:w,idType:s,idNumber:u,idExpiry:y,level:c,livenessMetrics:o}},K=await fetch("/api/kyc/upload",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(z)}),M=await K.json();if(!K.ok)throw Error(M.error||"Upload failed");let O=await fetch("/api/kyc/submit",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({level:c})}),P=await O.json();if(!O.ok)throw Error(P.error||"Submit failed");V("KYC submitted for review"),f(""),p(""),r(""),t("national_id"),v(""),B(null),D(null),F(null),H(null),J(null),L(1),N(!1),X()}catch(a){V(a.message)}finally{T(!1)}}(0,h.useEffect)(()=>{X()},[]),(0,h.useEffect)(()=>{if(!M)return;let a=document.querySelector("#kyc-selfie-video");return R(a),navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}).then(b=>{P(b),a&&(a.srcObject=b,a.play())}).catch(()=>{N(!1)}),()=>{try{O?.getTracks()?.forEach(a=>a.stop())}catch{}}},[M]);let aa=String(a?.kyc_status||"pending").toLowerCase(),ab=a?.kyc_submitted_at?new Date(a.kyc_submitted_at).toLocaleString():null;return(0,g.jsx)(i.default,{children:(0,g.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 py-10 px-4",children:(0,g.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,g.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-600 text-white flex items-center justify-center",children:(0,g.jsx)(m.IdCard,{className:"h-5 w-5"})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"KYC Verification"}),(0,g.jsx)("p",{className:"text-sm text-gray-600",children:"Securely verify your identity to unlock withdrawals and advanced features."})]})]}),U&&(0,g.jsx)("p",{className:`mb-3 text-sm ${"approved"===aa?"text-green-700":"text-blue-700"}`,children:U}),(0,g.jsxs)("div",{className:"rounded-2xl shadow-xl border border-gray-100 p-6 space-y-4 bg-white text-gray-900",children:[(0,g.jsxs)("p",{className:"text-sm",children:["Status: ",(0,g.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"approved"===aa?"bg-green-100 text-green-800":"rejected"===aa?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:aa})]}),ab&&(0,g.jsxs)("p",{className:"text-sm",children:["Submitted: ",ab]}),(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3",children:[(0,g.jsx)("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${K>=1?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:(0,g.jsx)(l,{className:"h-4 w-4"})}),(0,g.jsx)("div",{className:`h-1 w-10 rounded ${K>=2?"bg-blue-600":"bg-gray-200"}`}),(0,g.jsx)("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${K>=2?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:(0,g.jsx)(m.IdCard,{className:"h-4 w-4"})}),(0,g.jsx)("div",{className:`h-1 w-10 rounded ${K>=3?"bg-blue-600":"bg-gray-200"}`}),(0,g.jsx)("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${K>=3?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:(0,g.jsx)(n,{className:"h-4 w-4"})}),(0,g.jsx)("div",{className:`h-1 w-10 rounded ${K>=4?"bg-blue-600":"bg-gray-200"}`}),(0,g.jsx)("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${K>=4?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:(0,g.jsx)(o,{className:"h-4 w-4"})})]}),(0,g.jsxs)("div",{className:"text-xs text-gray-500",children:["Step ",K," of 4"]})]}),1===K&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Full Name"}),(0,g.jsx)("input",{value:e,onChange:a=>f(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John Doe"}),(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Date of Birth"}),(0,g.jsx)("input",{value:k,onChange:a=>p(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",type:"date"}),(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Address"}),(0,g.jsx)("input",{value:q,onChange:a=>r(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Street, City, Country"}),(0,g.jsx)("label",{className:"block text-sm font-medium",children:"KYC Level"}),(0,g.jsx)("select",{value:c,onChange:a=>d(Number(a.target.value)),className:"border rounded px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[1,2,3].map(a=>(0,g.jsxs)("option",{value:a,children:["Level ",a]},a))}),(0,g.jsx)("div",{className:"flex gap-2",children:(0,g.jsx)("button",{onClick:()=>L(2),className:"bg-blue-600 hover:bg-blue-700 transition text-white rounded-lg px-4 py-2",children:"Next"})})]}),2===K&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("label",{className:"block text-sm font-medium",children:"Government ID Type"}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-xs text-gray-900",children:"Country"}),(0,g.jsx)("select",{value:w,onChange:a=>{x(a.target.value);let b=W[a.target.value]?.idTypes[0]?.value;b&&t(b)},className:"border rounded px-3 py-2 w-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.keys(W).map(a=>(0,g.jsx)("option",{value:a,children:W[a].name},a))})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-xs text-gray-900",children:"ID Type"}),(0,g.jsx)("select",{value:s,onChange:a=>t(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(W[w]?.idTypes||[]).map(a=>(0,g.jsx)("option",{value:a.value,children:a.label},a.value))})]})]}),(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Government ID Number"}),(0,g.jsx)("input",{value:u,onChange:a=>v(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ID Number"}),(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"ID Expiry Date"}),(0,g.jsx)("input",{value:y,onChange:a=>z(a.target.value),className:"border rounded px-3 py-2 w-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",type:"date"}),(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Upload Government ID"}),(0,g.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-4 text-center",children:[(0,g.jsx)("input",{onChange:a=>B(a.target.files?.[0]||null),className:"w-full text-gray-900",type:"file",accept:"image/*,application/pdf"}),(0,g.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Accepted: JPG, PNG, PDF up to 10MB"})]}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)("button",{onClick:()=>L(1),className:"border text-blue-600 rounded-lg px-4 py-2",children:"Back"}),(0,g.jsx)("button",{onClick:()=>L(3),className:"bg-blue-600 hover:bg-blue-700 transition text-white rounded-lg px-4 py-2",children:"Next"})]})]}),3===K&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Selfie Liveness"}),!M&&(0,g.jsx)("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white rounded px-4 py-2",children:"Start Camera"}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)("video",{id:"kyc-selfie-video",className:"w-full rounded-lg border border-gray-200 shadow-sm"}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)("button",{onClick:async()=>{let a=await Y("selfie_neutral.jpg");a&&D(a)},className:"border rounded-lg px-4 py-2",children:"Capture Neutral"}),(0,g.jsx)("button",{onClick:async()=>{let a=await Y("selfie_smile.jpg");a&&F(a)},className:"border rounded-lg px-4 py-2",children:"Capture Smile"}),(0,g.jsx)("button",{onClick:async()=>{let a=await Y("selfie_left.jpg");a&&H(a)},className:"border rounded-lg px-4 py-2",children:"Capture Left"}),(0,g.jsx)("button",{onClick:async()=>{let a=await Y("selfie_right.jpg");a&&J(a)},className:"border rounded-lg px-4 py-2",children:"Capture Right"}),(0,g.jsx)("input",{onChange:a=>D(a.target.files?.[0]||null),className:"border rounded px-3 py-2 text-gray-900",type:"file",accept:"image/*"}),(0,g.jsx)("input",{onChange:a=>F(a.target.files?.[0]||null),className:"border rounded px-3 py-2 text-gray-900",type:"file",accept:"image/*"}),(0,g.jsx)("input",{onChange:a=>H(a.target.files?.[0]||null),className:"border rounded px-3 py-2 text-gray-900",type:"file",accept:"image/*"}),(0,g.jsx)("input",{onChange:a=>J(a.target.files?.[0]||null),className:"border rounded px-3 py-2 text-gray-900",type:"file",accept:"image/*"})]})]}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)("button",{onClick:()=>L(2),className:"border text-blue-600 rounded-lg px-4 py-2",children:"Back"}),(0,g.jsx)("button",{onClick:()=>L(4),className:"bg-blue-600 hover:bg-blue-700 transition text-white rounded-lg px-4 py-2",children:"Next"})]})]}),4===K&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"text-sm",children:"Review and submit."}),(0,g.jsx)("button",{disabled:S||"approved"===aa,onClick:_,className:"bg-blue-600 hover:bg-blue-700 transition text-white rounded-lg px-4 py-2 disabled:opacity-50",children:S?"Submittingâ€¦":"approved"===aa?"Already Approved":"Submit KYC"}),(0,g.jsx)("button",{onClick:()=>L(3),className:"border text-blue-600 rounded-lg px-4 py-2 ml-2",children:"Back"})]})]})]})})})}a.s(["default",()=>p],86760);var q=a.i(86760),r=a.i(9193);let s=(0,d.hoist)(q,"default"),t=(0,d.hoist)(q,"getStaticProps"),u=(0,d.hoist)(q,"getStaticPaths"),v=(0,d.hoist)(q,"getServerSideProps"),w=(0,d.hoist)(q,"config"),x=(0,d.hoist)(q,"reportWebVitals"),y=(0,d.hoist)(q,"unstable_getStaticProps"),z=(0,d.hoist)(q,"unstable_getStaticPaths"),A=(0,d.hoist)(q,"unstable_getStaticParams"),B=(0,d.hoist)(q,"unstable_getServerProps"),C=(0,d.hoist)(q,"unstable_getServerSideProps"),D=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/kyc",pathname:"/kyc",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:q}),E=(0,r.getHandler)({srcPage:"/kyc",config:w,userland:q,routeModule:D,getStaticPaths:u,getStaticProps:t,getServerSideProps:v});a.s(["config",0,w,"default",0,s,"getServerSideProps",0,v,"getStaticPaths",0,u,"getStaticProps",0,t,"handler",0,E,"reportWebVitals",0,x,"routeModule",0,D,"unstable_getServerProps",0,B,"unstable_getServerSideProps",0,C,"unstable_getStaticParams",0,A,"unstable_getStaticPaths",0,z,"unstable_getStaticProps",0,y],36139)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_pages_957543d9.js.map